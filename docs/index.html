<!doctype html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <meta name="color-scheme" content="light dark" />
        <title>Download Facebook Messenger Desktop</title>
        <style>
            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
            }

            :root {
                color-scheme: light dark;
                --bg: #ffffff;
                --bg-gradient: linear-gradient(
                    135deg,
                    #f8f9fa 0%,
                    #e9ecef 50%,
                    #f8f9fa 100%
                );
                --text: #1a1a1a;
                --text-muted: #666;
                --text-subtle: #888;
                --border: #e0e0e0;
                --btn-shadow: rgba(0, 132, 255, 0.25);
                --btn-shadow-hover: rgba(0, 132, 255, 0.35);
                --code-bg: #f4f4f4;
            }

            @media (prefers-color-scheme: dark) {
                :root {
                    --bg: #0a0a0a;
                    --bg-gradient: linear-gradient(
                        135deg,
                        #0a0a0a 0%,
                        #1a1a2e 50%,
                        #0f0f23 100%
                    );
                    --text: #ffffff;
                    --text-muted: #888;
                    --text-subtle: #666;
                    --border: #333;
                    --btn-shadow: rgba(0, 132, 255, 0.3);
                    --btn-shadow-hover: rgba(0, 132, 255, 0.4);
                    --code-bg: #1a1a1a;
                }
            }

            body {
                font-family:
                    -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto,
                    Helvetica, Arial, sans-serif;
                background: var(--bg-gradient);
                min-height: 100vh;
                display: flex;
                align-items: center;
                justify-content: center;
                color: var(--text);
            }

            .container {
                text-align: center;
                padding: 2rem;
                max-width: 600px;
            }

            .icon {
                width: 96px;
                height: 96px;
                margin-bottom: 1.5rem;
                border-radius: 20px;
            }

            h1 {
                font-size: 1.75rem;
                font-weight: 600;
                margin-bottom: 0.5rem;
            }

            .download-btn {
                display: inline-flex;
                align-items: center;
                gap: 0.5rem;
                background: #0084ff;
                color: white;
                padding: 0.6rem 1.25rem;
                border-radius: 8px;
                text-decoration: none;
                font-weight: 500;
                font-size: 0.9rem;
                transition: all 0.2s ease;
            }

            .download-btn:hover {
                background: #0073e6;
            }

            .download-btn svg {
                width: 16px;
                height: 16px;
            }

            .download-wrapper {
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                gap: 2rem;
            }

            .mac-homebrew-section {
                margin-top: 0;
                width: 100%;
                max-width: 380px;
            }

            .selection-flow {
                position: relative;
            }

            .connector-svg {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                pointer-events: none;
                z-index: 0;
            }

            .connector-path {
                fill: none;
                stroke-width: 2;
                stroke-linecap: round;
                stroke-linejoin: round;
                stroke-dasharray: 6 4;
                animation: flowDash 1s linear infinite;
            }

            .connector-path {
                stroke: url(#connector-gradient-blue);
            }

            body.beta-mode .connector-path {
                stroke: url(#connector-gradient-orange);
            }

            @keyframes flowDash {
                to {
                    stroke-dashoffset: -10;
                }
            }

            .platform-toggle {
                display: flex;
                justify-content: center;
                margin-bottom: 2rem;
                position: relative;
                z-index: 1;
            }

            .platform-btn {
                background: none;
                border: 1px solid var(--border);
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                cursor: pointer;
                color: var(--text-muted);
                transition: all 0.2s ease;
            }

            .platform-btn:first-child {
                border-radius: 8px 0 0 8px;
            }

            .platform-btn:last-child {
                border-radius: 0 8px 8px 0;
            }

            .platform-btn:not(:first-child) {
                margin-left: -1px;
            }

            .platform-btn:hover:not(.active) {
                border-color: #0084ff;
                color: #0084ff;
                position: relative;
                z-index: 1;
            }

            .platform-btn.active {
                background: #0084ff;
                border-color: #0084ff;
                color: white;
                position: relative;
                z-index: 1;
            }

            /* Beta mode styling - orange theme (#ff6b00) */
            body.beta-mode .platform-btn.active,
            body.beta-mode .arch-btn.active,
            body.beta-mode .format-btn.active {
                background: #ff6b00;
                border-color: #ff6b00;
            }

            body.beta-mode .platform-btn:hover:not(.active),
            body.beta-mode .arch-btn:hover:not(.active),
            body.beta-mode .format-btn:hover:not(.active):not(.disabled) {
                border-color: #ff6b00;
                color: #ff6b00;
            }

            body.beta-mode .download-btn {
                background: #ff6b00;
            }

            body.beta-mode .download-btn:hover {
                background: #e65c00;
            }

            body.beta-mode .command-label {
                color: #ff6b00;
            }

            .beta-notice {
                display: none;
                background: rgba(255, 107, 0, 0.1);
                border: 1px solid rgba(255, 107, 0, 0.3);
                border-radius: 8px;
                padding: 0.6rem 1rem;
                margin-top: 0;
                margin-bottom: 0.8rem;
                font-size: 0.75rem;
                color: var(--text-muted);
                max-width: 400px;
                margin-left: auto;
                margin-right: auto;
                text-align: center;
            }

            body.beta-mode .beta-notice {
                display: block;
            }

            .beta-notice strong {
                color: #ff6b00;
            }

            .version-display {
                font-size: 0.8rem;
                font-weight: 500;
                text-align: center;
                margin-bottom: 1rem;
                display: none;
            }

            .version-display.visible {
                display: block;
            }

            .version-display.stable {
                color: #0084ff;
            }

            .version-display.beta {
                color: #ff6b00;
            }

            .platform-link.hidden {
                display: none;
            }



            .github-icon-link {
                color: var(--text-muted);
                display: flex;
                align-items: center;
                transition: color 0.2s ease;
            }

            .github-icon-link:hover {
                color: var(--text);
            }

            .github-icon-link svg {
                width: 20px;
                height: 20px;
            }

            .linux-formats {
                display: none;
                flex-direction: column;
                align-items: center;
                gap: 2rem;
            }

            .linux-formats.visible {
                display: flex;
            }

            .linux-arch-toggle,
            .windows-arch-toggle,
            .mac-arch-toggle {
                display: flex;
                justify-content: center;
                position: relative;
            }

            .windows-arch-toggle,
            .mac-arch-toggle,
            .linux-arch-toggle {
                margin-bottom: 0;
            }

            .arch-btn {
                background: none;
                border: 1px solid var(--border);
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                cursor: pointer;
                color: var(--text-muted);
                transition: all 0.2s ease;
            }

            .arch-btn:first-child {
                border-radius: 8px 0 0 8px;
            }

            .arch-btn:last-child {
                border-radius: 0 8px 8px 0;
            }

            .arch-btn:not(:first-child) {
                margin-left: -1px;
            }

            .arch-btn:hover:not(.active) {
                border-color: #0084ff;
                color: #0084ff;
                position: relative;
                z-index: 1;
            }

            .arch-btn.active {
                background: #0084ff;
                border-color: #0084ff;
                color: white;
                position: relative;
                z-index: 1;
            }

            .linux-format-toggle {
                display: flex;
                justify-content: center;
                margin-bottom: 0;
                position: relative;
            }

            .format-btn {
                background: none;
                border: 1px solid var(--border);
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                cursor: pointer;
                color: var(--text-muted);
                transition: all 0.2s ease;
            }

            .format-btn:first-child {
                border-radius: 8px 0 0 8px;
            }

            .format-btn:last-child {
                border-radius: 0 8px 8px 0;
            }

            .format-btn:not(:first-child) {
                margin-left: -1px;
            }

            .format-btn:hover {
                border-color: #0084ff;
                color: #0084ff;
                position: relative;
                z-index: 1;
            }

            .format-btn.active {
                background: #0084ff;
                border-color: #0084ff;
                color: white;
                position: relative;
                z-index: 1;
            }

            .format-btn.disabled {
                opacity: 0.4;
                cursor: not-allowed;
            }

            .format-btn.disabled:hover {
                border-color: var(--border);
                color: var(--text-muted);
            }

            .linux-format-content {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 2rem;
            }

            .linux-command-section {
                width: 100%;
                max-width: 380px;
            }

            .linux-format-note {
                font-size: 0.8rem;
                color: var(--text-muted);
                text-align: center;
                padding: 0.5rem;
                background: rgba(0, 132, 255, 0.05);
                border-radius: 6px;
                max-width: 400px;
            }

            .format-list {
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .format-section-label {
                font-size: 0.75rem;
                font-weight: 600;
                color: var(--text-muted);
                text-transform: uppercase;
                letter-spacing: 0.05em;
                margin-top: 0.5rem;
                margin-bottom: -0.25rem;
            }

            .format-section-label:first-child {
                margin-top: 0;
            }

            .command-label {
                font-size: 0.9rem;
                color: white;
                margin-bottom: 0;
                font-weight: 500;
                text-align: center;
            }

            .format-item {
                background: var(--code-bg);
                border: 1px solid var(--border);
                border-radius: 10px;
                padding: 1rem;
                text-align: left;
            }

            .format-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 0.5rem;
            }

            .format-title {
                display: flex;
                align-items: center;
                gap: 0.5rem;
            }

            .format-name {
                font-weight: 600;
                font-size: 0.95rem;
                color: var(--text);
            }

            .format-desc {
                font-size: 0.75rem;
                color: var(--text-muted);
                background: var(--border);
                padding: 0.15rem 0.5rem;
                border-radius: 4px;
            }

            .format-download {
                display: inline-flex;
                align-items: center;
                gap: 0.4rem;
                color: #0084ff;
                text-decoration: none;
                font-size: 0.8rem;
                font-weight: 500;
                padding: 0.3rem 0.75rem;
                border: 1px solid #0084ff;
                border-radius: 6px;
                transition: all 0.2s ease;
            }

            .format-download:hover {
                background: #0084ff;
                color: white;
            }

            .format-download .ext {
                opacity: 1;
                font-weight: 400;
            }

            .format-download:hover .ext {
                opacity: 1;
            }

            .format-command {
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.75rem;
                background: #0084ff;
                border: none;
                border-radius: 8px;
                padding: 0.75rem 1.25rem;
                max-width: 380px;
                margin: 0 auto;
            }

            .format-command code {
                display: none;
            }

            .copy-btn {
                position: static;
                background: none;
                border: none;
                cursor: pointer;
                padding: 0;
                color: white;
                transition: opacity 0.2s ease;
                display: flex;
                align-items: center;
                border-radius: 0;
            }

            .copy-btn:hover {
                opacity: 0.8;
            }

            .copy-btn svg {
                width: 18px;
                height: 18px;
            }

            .copy-btn.copied {
                color: #22c55e;
            }

            body.beta-mode .format-command {
                background: #ff6b00;
            }

            body.beta-mode .format-command:hover {
                opacity: 0.9;
            }

            .format-pending {
                font-size: 0.7rem;
                color: #ff6b00;
                padding: 0.2rem 0.5rem;
                border: 1px solid #ff6b00;
                border-radius: 4px;
            }

            .format-command.format-disabled {
                opacity: 0.5;
            }

            .channel-toggle {
                display: flex;
                justify-content: center;
                margin-bottom: 2rem;
                gap: 0;
            }

            .channel-btn {
                background: none;
                border: 1px solid var(--border);
                padding: 0.5rem 1rem;
                font-size: 0.85rem;
                cursor: pointer;
                color: var(--text-muted);
                transition: all 0.2s ease;
            }

            .channel-btn:first-child {
                border-radius: 8px 0 0 8px;
            }

            .channel-btn:last-child {
                border-radius: 0 8px 8px 0;
                margin-left: -1px;
            }

            .channel-btn:hover:not(.active) {
                border-color: #0084ff;
                color: #0084ff;
                position: relative;
                z-index: 1;
            }

            .channel-btn#channel-beta:hover:not(.active) {
                border-color: #ff6b00;
                color: #ff6b00;
            }

            .channel-btn.active {
                background: #0084ff;
                border-color: #0084ff;
                color: white;
                position: relative;
                z-index: 1;
            }

            .channel-btn.active.beta-active {
                background: #ff6b00;
                border-color: #ff6b00;
            }

            .spinner {
                display: none;
                width: 20px;
                height: 20px;
                border: 2px solid rgba(255, 255, 255, 0.3);
                border-top-color: white;
                border-radius: 50%;
                animation: spin 0.8s linear infinite;
            }

            @keyframes spin {
                to {
                    transform: rotate(360deg);
                }
            }

            .downloading .spinner {
                display: block;
            }
            .downloading .download-icon {
                display: none;
            }

            /* Connector lines styling */
            .connector-svg {
                display: block;
            }

            .connector-path {
                filter: drop-shadow(0 0 3px rgba(0, 132, 255, 0.5));
            }

            body.beta-mode .connector-path {
                filter: drop-shadow(0 0 3px rgba(255, 107, 0, 0.5));
            }

            /* Mobile Responsiveness */
            @media (max-width: 640px) {
                .connector-svg {
                    display: block;
                }
                
                .connector-path {
                    stroke-width: 1.5;
                }

                .channel-toggle,
                .platform-toggle {
                    margin-bottom: 1.5rem;
                }

                .container {
                    padding: 1.5rem 1rem;
                }

                h1 {
                    font-size: 1.4rem;
                }

                .icon {
                    width: 72px;
                    height: 72px;
                    margin-bottom: 1rem;
                }

                /* Consistent button styles for all toggles */
                .platform-btn,
                .arch-btn,
                .format-btn,
                .channel-btn {
                    padding: 0.4rem 0.6rem;
                    font-size: 0.75rem;
                }

                .linux-format-toggle {
                     display: flex;
                     flex-wrap: nowrap;
                     justify-content: center;
                     gap: 0;
                     overflow-x: auto;
                     padding-bottom: 0.25rem;
                 }

                 .linux-format-toggle .format-btn {
                     border-radius: 0;
                     margin-left: -1px;
                     padding: 0.4rem 0.4rem;
                     font-size: 0.65rem;
                     white-space: nowrap;
                     flex-shrink: 0;
                 }

                 .linux-format-toggle .format-btn:first-child {
                     border-radius: 6px 0 0 6px;
                     margin-left: 0;
                 }

                 .linux-format-toggle .format-btn:last-child {
                     border-radius: 0 6px 6px 0;
                 }

                .format-command {
                    max-width: calc(100vw - 2rem);
                }

                .format-command code {
                    font-size: 0.75rem;
                    word-break: break-all;
                }

                .linux-command-section,
                .mac-homebrew-section {
                    max-width: calc(100vw - 2rem);
                    overflow: hidden;
                }

                .copy-btn {
                    padding: 0.25rem 0.5rem;
                    flex-shrink: 0;
                }

                .mac-homebrew-section {
                    max-width: 100%;
                }

                .linux-command-section {
                    max-width: 100%;
                }

                .download-btn {
                    padding: 0.5rem 1rem;
                    font-size: 0.85rem;
                }

                .beta-notice {
                    font-size: 0.75rem;
                    padding: 0.6rem 0.75rem;
                    margin-left: 0.5rem;
                    margin-right: 0.5rem;
                }

                .version-display {
                    font-size: 0.7rem;
                }
            }

            @media (max-width: 480px) {
                .container {
                    padding: 1rem 0.75rem;
                }

                h1 {
                    font-size: 1.25rem;
                }

                .icon {
                    width: 64px;
                    height: 64px;
                }

                .platform-btn,
                .arch-btn,
                .channel-btn {
                    padding: 0.35rem 0.6rem;
                    font-size: 0.75rem;
                }

                .format-btn {
                    font-size: 0.65rem;
                    padding: 0.35rem 0.5rem;
                }

                .format-command code {
                    font-size: 0.6rem;
                }

                .command-label {
                    font-size: 0.7rem;
                }

                .linux-formats {
                    gap: 1.5rem;
                }

                .linux-format-content {
                    gap: 1.5rem;
                }

                .download-btn {
                    padding: 0.45rem 0.9rem;
                    font-size: 0.8rem;
                }

                .beta-notice {
                    font-size: 0.7rem;
                    padding: 0.5rem 0.6rem;
                }
            }

            @media (max-width: 360px) {
                .container {
                    padding: 0.75rem 0.5rem;
                }

                h1 {
                    font-size: 1.1rem;
                }

                .icon {
                    width: 56px;
                    height: 56px;
                }

                .platform-btn,
                .arch-btn,
                .channel-btn {
                    padding: 0.3rem 0.5rem;
                    font-size: 0.7rem;
                }

                .format-btn {
                    font-size: 0.6rem;
                    padding: 0.3rem 0.4rem;
                }

                .download-btn {
                    padding: 0.4rem 0.8rem;
                    font-size: 0.75rem;
                }

                .format-command code {
                    font-size: 0.55rem;
                }
            }
        </style>
    </head>
    <body>
        <div class="container">
            <img
                src="https://raw.githubusercontent.com/apotenza92/facebook-messenger-desktop/main/assets/icons/icon-rounded.png"
                alt="Messenger"
                class="icon"
            />
            <h1>Facebook Messenger Desktop</h1>
            <p
                style="
                    font-size: 0.85rem;
                    color: var(--text-muted);
                    margin-top: 1rem;
                    margin-bottom: 0.75rem;
                "
            >
                An unofficial desktop application for Facebook Messenger.
            </p>

            <div style="display: flex; justify-content: center; margin-bottom: 1rem;">
                <a
                    href="https://github.com/apotenza92/facebook-messenger-desktop"
                    class="github-icon-link"
                    title="View on GitHub"
                >
                    <svg viewBox="0 0 24 24" fill="currentColor">
                        <path
                            d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"
                        />
                    </svg>
                </a>
            </div>

            <div class="selection-flow" id="selection-flow">
                <svg class="connector-svg" id="connector-svg"></svg>

                <div class="version-display" id="version-display"></div>

                <div
                    class="channel-toggle"
                    id="channel-toggle"
                    style="display: none"
                >
                    <button class="channel-btn active" id="channel-stable">
                        Stable
                    </button>
                    <button class="channel-btn" id="channel-beta">Beta</button>
                </div>

                <div class="platform-toggle" id="platform-toggle">
                    <button class="platform-btn" id="platform-btn-mac">
                        macOS
                    </button>
                    <button class="platform-btn" id="platform-btn-windows">
                        Windows
                    </button>
                    <button class="platform-btn" id="platform-btn-linux">
                        Linux
                    </button>
                </div>

                <div class="download-wrapper" id="download-wrapper">
                    <div
                        class="windows-arch-toggle"
                        id="windows-arch-toggle"
                        style="display: none"
                    >
                        <button class="arch-btn active" id="windows-arch-x64">
                            x64</button
                        ><button class="arch-btn" id="windows-arch-arm64">
                            ARM64
                        </button>
                    </div>
                    <div
                        class="mac-arch-toggle"
                        id="mac-arch-toggle"
                        style="display: none"
                    >
                        <button class="arch-btn active" id="mac-arch-arm">
                            Apple Silicon</button
                        ><button class="arch-btn" id="mac-arch-intel">
                            Intel
                        </button>
                    </div>
                    <a href="#" class="download-btn" id="download-btn">
                        <svg
                            class="download-icon"
                            viewBox="0 0 24 24"
                            fill="currentColor"
                        >
                            <path
                                d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                            />
                        </svg>
                        <div class="spinner"></div>
                        <span id="btn-text">Download</span>
                    </a>
                    <div
                        class="mac-homebrew-section"
                        id="mac-homebrew-section"
                        style="display: none"
                    >
                        <div class="command-label" id="mac-homebrew-label">
                            Or install via Homebrew:
                        </div>
                        <div class="format-command">
                            <code id="mac-homebrew-code"
                                >brew install --cask
                                apotenza92/tap/facebook-messenger-desktop</code
                            >
                            <button
                                class="copy-btn"
                                id="mac-homebrew-copy"
                                title="Copy command"
                            >
                                <svg viewBox="0 0 24 24" fill="currentColor">
                                    <path
                                        d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"
                                    />
                                </svg>
                            </button>
                        </div>
                    </div>
                    <div class="beta-notice" id="beta-notice-main">
                       <strong>Beta Version:</strong> You are downloading a pre-release version. Beta builds may contain bugs or incomplete features.
                    </div>
                    </div>

                <div class="linux-formats" id="linux-formats">
                    <div class="linux-arch-toggle">
                        <button class="arch-btn active" id="arch-x64">
                            x64</button
                        ><button class="arch-btn" id="arch-arm64">ARM64</button>
                    </div>

                    <div class="linux-format-toggle" id="linux-format-toggle">
                        <button
                            class="format-btn active"
                            data-format="appimage"
                        >
                            AppImage
                        </button>
                        <button class="format-btn" data-format="deb">
                            Ubuntu / Debian (.deb)
                        </button>
                        <button class="format-btn" data-format="rpm">
                            Fedora (.rpm)
                        </button>
                        <button class="format-btn" data-format="snap">
                            Snap
                        </button>
                        <button class="format-btn" data-format="flatpak">
                            Flatpak
                        </button>
                    </div>

                    <div class="linux-format-content" id="linux-format-content">
                        <a
                            href="#"
                            class="download-btn"
                            id="linux-download-btn"
                        >
                            <svg
                                class="download-icon"
                                viewBox="0 0 24 24"
                                fill="currentColor"
                            >
                                <path
                                    d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"
                                />
                            </svg>
                            <span id="linux-btn-text">Download AppImage</span>
                        </a>
                        <div class="linux-command-section">
                            <div class="command-label" id="linux-command-label">
                                Or download and run AppImage via terminal:
                            </div>
                            <div class="format-command">
                                <code id="linux-command-code"
                                    >wget -qO
                                    facebook-messenger-desktop-x86_64.AppImage
                                    https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage
                                    && chmod +x
                                    facebook-messenger-desktop-x86_64.AppImage
                                    &&
                                    ./facebook-messenger-desktop-x86_64.AppImage</code
                                >
                                <button
                                    class="copy-btn"
                                    title="Copy command"
                                    id="linux-copy-btn"
                                >
                                    <svg
                                        viewBox="0 0 24 24"
                                        fill="currentColor"
                                    >
                                        <path
                                            d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"
                                        />
                                    </svg>
                                </button>
                            </div>
                        </div>
                        <div
                            class="linux-format-note"
                            id="linux-format-note"
                            style="display: none"
                        ></div>
                        <div class="beta-notice" id="beta-notice-linux">
                            <strong>Beta Version:</strong> You are downloading a pre-release version. Beta builds may contain bugs or incomplete features.
                        </div>
                    </div>
                </div>
            </div>

            <p
                style="
                    font-size: 0.7rem;
                    color: var(--text-subtle);
                    margin-top: 2rem;
                    max-width: 500px;
                    margin-left: auto;
                    margin-right: auto;
                    line-height: 1.4;
                "
            >
                <strong>Trademark Notice:</strong> This project is not
                affiliated with, endorsed by, or connected to Facebook, Inc. or
                Meta Platforms, Inc. "Facebook" and "Messenger" are trademarks
                of Meta Platforms, Inc. This is an independent, open-source
                project.
            </p>
        </div>

        <script>
            // Generate a smooth S-curve between two points
            function createCurvedPath(x1, y1, x2, y2) {
                // Always use smooth S-curve with cubic bezier
                const ctrl1Y = y1 + (y2 - y1) * 0.49;
                const ctrl2Y = y1 + (y2 - y1) * 0.51;
                return `M ${x1} ${y1} C ${x1} ${ctrl1Y} ${x2} ${ctrl2Y} ${x2} ${y2}`;
            }

            function updateConnectors() {
                 const svg = document.getElementById("connector-svg");
                 const flow = document.getElementById("selection-flow");
                 if (!svg || !flow) return;

                 const flowRect = flow.getBoundingClientRect();
                 svg.innerHTML = "";

                 // Create gradient definitions for fade-out effect
                 const defs = document.createElementNS("http://www.w3.org/2000/svg", "defs");
                 
                 // Blue gradient (stable mode)
                 const blueGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
                 blueGradient.setAttribute("id", "connector-gradient-blue");
                 blueGradient.setAttribute("x1", "0%");
                 blueGradient.setAttribute("y1", "0%");
                 blueGradient.setAttribute("x2", "100%");
                 blueGradient.setAttribute("y2", "100%");
                 const blueStop1 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                 blueStop1.setAttribute("offset", "0%");
                 blueStop1.setAttribute("stop-color", "#0084ff");
                 blueStop1.setAttribute("stop-opacity", "0");
                 const blueStop2 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                 blueStop2.setAttribute("offset", "15%");
                 blueStop2.setAttribute("stop-color", "#0084ff");
                 blueStop2.setAttribute("stop-opacity", "1");
                 const blueStop3 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                 blueStop3.setAttribute("offset", "85%");
                 blueStop3.setAttribute("stop-color", "#0084ff");
                 blueStop3.setAttribute("stop-opacity", "1");
                 const blueStop4 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                 blueStop4.setAttribute("offset", "100%");
                 blueStop4.setAttribute("stop-color", "#0084ff");
                 blueStop4.setAttribute("stop-opacity", "0");
                 blueGradient.appendChild(blueStop1);
                 blueGradient.appendChild(blueStop2);
                 blueGradient.appendChild(blueStop3);
                 blueGradient.appendChild(blueStop4);
                 defs.appendChild(blueGradient);

                 // Orange gradient (beta mode)
                 const orangeGradient = document.createElementNS("http://www.w3.org/2000/svg", "linearGradient");
                 orangeGradient.setAttribute("id", "connector-gradient-orange");
                 orangeGradient.setAttribute("x1", "0%");
                 orangeGradient.setAttribute("y1", "0%");
                 orangeGradient.setAttribute("x2", "100%");
                 orangeGradient.setAttribute("y2", "100%");
                 const orangeStop1 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                 orangeStop1.setAttribute("offset", "0%");
                 orangeStop1.setAttribute("stop-color", "#ff6b00");
                 orangeStop1.setAttribute("stop-opacity", "0");
                 const orangeStop2 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                 orangeStop2.setAttribute("offset", "15%");
                 orangeStop2.setAttribute("stop-color", "#ff6b00");
                 orangeStop2.setAttribute("stop-opacity", "1");
                 const orangeStop3 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                 orangeStop3.setAttribute("offset", "85%");
                 orangeStop3.setAttribute("stop-color", "#ff6b00");
                 orangeStop3.setAttribute("stop-opacity", "1");
                 const orangeStop4 = document.createElementNS("http://www.w3.org/2000/svg", "stop");
                 orangeStop4.setAttribute("offset", "100%");
                 orangeStop4.setAttribute("stop-color", "#ff6b00");
                 orangeStop4.setAttribute("stop-opacity", "0");
                 orangeGradient.appendChild(orangeStop1);
                 orangeGradient.appendChild(orangeStop2);
                 orangeGradient.appendChild(orangeStop3);
                 orangeGradient.appendChild(orangeStop4);
                 defs.appendChild(orangeGradient);

                 svg.appendChild(defs);

                // Get active channel button (if visible)
                const channelToggle = document.getElementById("channel-toggle");
                const activeChannel = document.querySelector(".channel-btn.active");

                // Get active platform button
                const activePlatform = document.querySelector(
                    ".platform-btn.active",
                );
                if (!activePlatform) return;

                const platformRect = activePlatform.getBoundingClientRect();
                const platformCenterX =
                    platformRect.left + platformRect.width / 2 - flowRect.left;
                const platformTopY = platformRect.top - flowRect.top;
                const platformBottomY = platformRect.bottom - flowRect.top;

                // Draw connector from channel to platform (if channel toggle is visible)
                if (channelToggle && channelToggle.style.display !== "none" && activeChannel) {
                    const channelRect = activeChannel.getBoundingClientRect();
                    const channelCenterX = channelRect.left + channelRect.width / 2 - flowRect.left;
                    const channelBottomY = channelRect.bottom - flowRect.top;

                    const pathChannel = document.createElementNS("http://www.w3.org/2000/svg", "path");
                    pathChannel.setAttribute("d", createCurvedPath(channelCenterX, channelBottomY, platformCenterX, platformTopY));
                    pathChannel.setAttribute("class", "connector-path");
                    svg.appendChild(pathChannel);
                }

                // Check which view is active
                const downloadWrapper =
                    document.getElementById("download-wrapper");
                const linuxFormats = document.getElementById("linux-formats");
                const isLinux = linuxFormats.classList.contains("visible");

                if (isLinux) {
                    // Linux: Platform -> Arch -> Format -> Download
                    const activeArch = document.querySelector(
                        ".linux-arch-toggle .arch-btn.active",
                    );
                    const activeFormat =
                        document.querySelector(".format-btn.active");
                    const downloadBtn =
                        document.getElementById("linux-download-btn");

                    if (activeArch) {
                        const archRect = activeArch.getBoundingClientRect();
                        const archCenterX =
                            archRect.left + archRect.width / 2 - flowRect.left;
                        const archTopY = archRect.top - flowRect.top;
                        const archBottomY = archRect.bottom - flowRect.top;

                        // Draw path from platform to arch
                        const path1 = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "path",
                        );
                        path1.setAttribute(
                            "d",
                            createCurvedPath(
                                platformCenterX,
                                platformBottomY,
                                archCenterX,
                                archTopY,
                            ),
                        );
                        path1.setAttribute("class", "connector-path");
                        svg.appendChild(path1);

                        if (activeFormat) {
                            const formatRect =
                                activeFormat.getBoundingClientRect();
                            const formatCenterX =
                                formatRect.left +
                                formatRect.width / 2 -
                                flowRect.left;
                            const formatTopY = formatRect.top - flowRect.top;
                            const formatBottomY =
                                formatRect.bottom - flowRect.top;

                            // Draw path from arch to format
                            const path2 = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "path",
                            );
                            path2.setAttribute(
                                "d",
                                createCurvedPath(
                                    archCenterX,
                                    archBottomY,
                                    formatCenterX,
                                    formatTopY,
                                ),
                            );
                            path2.setAttribute("class", "connector-path");
                            svg.appendChild(path2);

                            if (
                                 downloadBtn &&
                                 downloadBtn.offsetParent !== null
                             ) {
                                 const dlRect =
                                     downloadBtn.getBoundingClientRect();
                                 const dlCenterX =
                                     dlRect.left +
                                     dlRect.width / 2 -
                                     flowRect.left;
                                 const dlTopY = dlRect.top - flowRect.top;
                                 const dlBottomY = dlRect.bottom - flowRect.top;

                                 // Draw path from format to download
                                 const path3 = document.createElementNS(
                                     "http://www.w3.org/2000/svg",
                                     "path",
                                 );
                                 path3.setAttribute(
                                     "d",
                                     createCurvedPath(
                                         formatCenterX,
                                         formatBottomY,
                                         dlCenterX,
                                         dlTopY,
                                     ),
                                 );
                                 path3.setAttribute("class", "connector-path");
                                 svg.appendChild(path3);

                                 // Draw path from download button to linux command section if visible
                                 const commandSection = document.querySelector(".linux-command-section");
                                 if (commandSection && commandSection.style.display !== "none") {
                                     const cmdRect = commandSection.getBoundingClientRect();
                                     const cmdCenterX = cmdRect.left + cmdRect.width / 2 - flowRect.left;
                                     const cmdTopY = cmdRect.top - flowRect.top;

                                     const pathCmd = document.createElementNS(
                                         "http://www.w3.org/2000/svg",
                                         "path",
                                     );
                                     pathCmd.setAttribute(
                                         "d",
                                         createCurvedPath(
                                             dlCenterX,
                                             dlBottomY,
                                             cmdCenterX,
                                             cmdTopY,
                                         ),
                                     );
                                     pathCmd.setAttribute("class", "connector-path");
                                     svg.appendChild(pathCmd);
                                 }
                             } else {
                                 // No download button (e.g., Flatpak) - draw from format directly to command section
                                 const commandSection = document.querySelector(".linux-command-section");
                                 if (commandSection && commandSection.style.display !== "none") {
                                     const cmdRect = commandSection.getBoundingClientRect();
                                     const cmdCenterX = cmdRect.left + cmdRect.width / 2 - flowRect.left;
                                     const cmdTopY = cmdRect.top - flowRect.top;

                                     const pathCmd = document.createElementNS(
                                         "http://www.w3.org/2000/svg",
                                         "path",
                                     );
                                     pathCmd.setAttribute(
                                         "d",
                                         createCurvedPath(
                                             formatCenterX,
                                             formatBottomY,
                                             cmdCenterX,
                                             cmdTopY,
                                         ),
                                     );
                                     pathCmd.setAttribute("class", "connector-path");
                                     svg.appendChild(pathCmd);
                                 }
                             }
                        }
                    }
                } else {
                    // Windows/Mac: Platform -> Arch -> Download
                    const macArch = document.querySelector(
                        ".mac-arch-toggle .arch-btn.active",
                    );
                    const winArch = document.querySelector(
                        ".windows-arch-toggle .arch-btn.active",
                    );
                    const activeArch =
                        macArch && macArch.offsetParent !== null
                            ? macArch
                            : winArch && winArch.offsetParent !== null
                              ? winArch
                              : null;
                    const downloadBtn = document.getElementById("download-btn");

                    if (activeArch) {
                        const archRect = activeArch.getBoundingClientRect();
                        const archCenterX =
                            archRect.left + archRect.width / 2 - flowRect.left;
                        const archTopY = archRect.top - flowRect.top;
                        const archBottomY = archRect.bottom - flowRect.top;

                        // Draw path from platform to arch
                        const path1 = document.createElementNS(
                            "http://www.w3.org/2000/svg",
                            "path",
                        );
                        path1.setAttribute(
                            "d",
                            createCurvedPath(
                                platformCenterX,
                                platformBottomY,
                                archCenterX,
                                archTopY,
                            ),
                        );
                        path1.setAttribute("class", "connector-path");
                        svg.appendChild(path1);

                        if (downloadBtn) {
                            const dlRect = downloadBtn.getBoundingClientRect();
                            const dlCenterX =
                                dlRect.left + dlRect.width / 2 - flowRect.left;
                            const dlTopY = dlRect.top - flowRect.top;
                            const dlBottomY = dlRect.bottom - flowRect.top;

                            // Draw path from arch to download
                            const path2 = document.createElementNS(
                                "http://www.w3.org/2000/svg",
                                "path",
                            );
                            path2.setAttribute(
                                "d",
                                createCurvedPath(
                                    archCenterX,
                                    archBottomY,
                                    dlCenterX,
                                    dlTopY,
                                ),
                            );
                            path2.setAttribute("class", "connector-path");
                            svg.appendChild(path2);

                            // Draw path from download button to homebrew section if visible
                            const homebrewSection = document.getElementById("mac-homebrew-section");
                            if (homebrewSection && homebrewSection.style.display !== "none") {
                                const brewRect = homebrewSection.getBoundingClientRect();
                                const brewCenterX = brewRect.left + brewRect.width / 2 - flowRect.left;
                                const brewTopY = brewRect.top - flowRect.top;

                                const pathBrew = document.createElementNS(
                                    "http://www.w3.org/2000/svg",
                                    "path",
                                );
                                pathBrew.setAttribute(
                                    "d",
                                    createCurvedPath(
                                        dlCenterX,
                                        dlBottomY,
                                        brewCenterX,
                                        brewTopY,
                                    ),
                                );
                                pathBrew.setAttribute("class", "connector-path");
                                svg.appendChild(pathBrew);
                            }
                        }
                    }
                }
            }

            const downloads = {
                "mac-arm": {
                    url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-macos-arm64.zip",
                    name: "macOS (Apple Silicon)",
                    file: "Messenger-macos-arm64.zip",
                    ext: ".zip",
                },
                "mac-intel": {
                    url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-macos-x64.zip",
                    name: "macOS (Intel)",
                    file: "Messenger-macos-x64.zip",
                    ext: ".zip",
                },
                windows: {
                    url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-windows-x64-setup.exe",
                    name: "Windows",
                    file: "Messenger-windows-x64-setup.exe",
                    ext: ".exe",
                },
                "windows-arm": {
                    url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-windows-arm64-setup.exe",
                    name: "Windows (ARM)",
                    file: "Messenger-windows-arm64-setup.exe",
                    ext: ".exe",
                },
                linux: {
                    url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage",
                    name: "Linux",
                    file: "facebook-messenger-desktop-x86_64.AppImage",
                    ext: ".AppImage",
                    showFormats: true,
                    arch: "x64",
                },
                "linux-arm": {
                    url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage",
                    name: "Linux (ARM64)",
                    file: "facebook-messenger-desktop-arm64.AppImage",
                    ext: ".AppImage",
                    showFormats: true,
                    arch: "arm64",
                },
            };

            let currentPlatform = null;

            function getPlatformFromURL() {
                const params = new URLSearchParams(window.location.search);
                const platformParam = params.get("platform");
                if (platformParam === "windows") {
                    return "windows";
                } else if (platformParam === "linux") {
                    return "linux";
                } else if (platformParam === "mac") {
                    return "mac";
                }
                return null;
            }

            function getArchFromURL() {
                const params = new URLSearchParams(window.location.search);
                return params.get("arch"); // Returns 'x64', 'arm64', 'arm', 'intel', or null
            }

            function detectPlatform() {
                // Check URL parameter first
                const urlPlatform = getPlatformFromURL();
                if (urlPlatform) {
                    // If platform is specified, check for architecture override
                    const urlArch = getArchFromURL();
                    if (urlPlatform === "windows" && urlArch === "arm64") {
                        return "windows-arm";
                    } else if (urlPlatform === "linux" && urlArch === "arm64") {
                        return "linux-arm";
                    } else if (urlPlatform === "mac") {
                        if (urlArch === "intel" || urlArch === "x64") {
                            return "mac-intel";
                        } else if (urlArch === "arm" || urlArch === "arm64") {
                            return "mac-arm";
                        }
                        // If no arch specified for mac, will auto-detect below
                    } else {
                        return urlPlatform;
                    }
                }

                const ua = navigator.userAgent.toLowerCase();
                const platform = navigator.platform?.toLowerCase() || "";

                // Check for Windows
                if (ua.includes("win")) {
                    if (ua.includes("arm") || ua.includes("aarch64")) {
                        return "windows-arm";
                    }
                    return "windows";
                }

                // Check for macOS
                if (ua.includes("mac")) {
                    const canvas = document.createElement("canvas");
                    const gl = canvas.getContext("webgl");
                    let isAppleSilicon = false;

                    if (gl) {
                        const debugInfo = gl.getExtension(
                            "WEBGL_debug_renderer_info",
                        );
                        if (debugInfo) {
                            const renderer = gl.getParameter(
                                debugInfo.UNMASKED_RENDERER_WEBGL,
                            );
                            if (
                                renderer &&
                                renderer.toLowerCase().includes("apple")
                            ) {
                                isAppleSilicon = true;
                            }
                        }
                    }

                    if (
                        platform.includes("arm") ||
                        ua.includes("arm64") ||
                        isAppleSilicon
                    ) {
                        return "mac-arm";
                    }
                    // If not Apple Silicon, it's Intel
                    return "mac-intel";
                }

                // Check for Linux
                if (ua.includes("linux") && !ua.includes("android")) {
                    if (
                        ua.includes("aarch64") ||
                        ua.includes("arm64") ||
                        platform.includes("arm")
                    ) {
                        return "linux-arm";
                    }
                    return "linux";
                }

                return "windows";
            }

            // Linux format data
            const linuxFormats = {
                x64: {
                    appimage: {
                        url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage",
                        btnText: "Download AppImage (x64)",
                        label: "Or download and run AppImage via terminal:",
                        command:
                            "wget -qO facebook-messenger-desktop-x86_64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage && chmod +x facebook-messenger-desktop-x86_64.AppImage && ./facebook-messenger-desktop-x86_64.AppImage",
                    },
                    deb: {
                        url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-amd64.deb",
                        btnText: "Download .deb (x64)",
                        label: "Or download and install .deb via terminal:",
                        command:
                            "wget -qO facebook-messenger-desktop-amd64.deb https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-amd64.deb && sudo apt install ./facebook-messenger-desktop-amd64.deb",
                    },
                    rpm: {
                        url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.rpm",
                        btnText: "Download .rpm (x64)",
                        label: "Or download and install .rpm via terminal:",
                        command:
                            "wget -qO facebook-messenger-desktop-x86_64.rpm https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.rpm && sudo dnf install ./facebook-messenger-desktop-x86_64.rpm",
                    },
                    snap: {
                        url: "https://snapcraft.io/facebook-messenger-desktop",
                        btnText: "View in Snap Store",
                        label: "Or install Snap via terminal:",
                        command: "sudo snap install facebook-messenger-desktop",
                        external: true,
                    },
                    flatpak: {
                        url: null,
                        btnText: "Install via Terminal",
                        label: "Add Flatpak repository and install:",
                        command:
                            "wget -qO /tmp/messenger.gpg https://apotenza92.github.io/facebook-messenger-desktop/flatpak/repo/flatpak-repo.gpg && flatpak remote-add --if-not-exists --user --gpg-import=/tmp/messenger.gpg messenger https://apotenza92.github.io/facebook-messenger-desktop/flatpak/repo && flatpak install --user messenger com.facebook.messenger.desktop",
                        noDownload: true,
                    },
                },
                arm64: {
                    appimage: {
                        url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage",
                        btnText: "Download AppImage (ARM64)",
                        label: "Or download and run AppImage via terminal:",
                        command:
                            "wget -qO facebook-messenger-desktop-arm64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage && chmod +x facebook-messenger-desktop-arm64.AppImage && ./facebook-messenger-desktop-arm64.AppImage",
                    },
                    deb: {
                        url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.deb",
                        btnText: "Download .deb (ARM64)",
                        label: "Or download and install .deb via terminal:",
                        command:
                            "wget -qO facebook-messenger-desktop-arm64.deb https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.deb && sudo apt install ./facebook-messenger-desktop-arm64.deb",
                    },
                    rpm: {
                        url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-aarch64.rpm",
                        btnText: "Download .rpm (ARM64)",
                        label: "Or download and install .rpm via terminal:",
                        command:
                            "wget -qO facebook-messenger-desktop-aarch64.rpm https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-aarch64.rpm && sudo dnf install ./facebook-messenger-desktop-aarch64.rpm",
                    },
                    snap: {
                        url: "https://snapcraft.io/facebook-messenger-desktop",
                        btnText: "View in Snap Store",
                        label: "Or install Snap via terminal:",
                        command: "sudo snap install facebook-messenger-desktop",
                        external: true,
                    },
                    flatpak: {
                        url: null,
                        btnText: "Install via Terminal",
                        label: "Add Flatpak repository and install:",
                        command:
                            "wget -qO /tmp/messenger.gpg https://apotenza92.github.io/facebook-messenger-desktop/flatpak/repo/flatpak-repo.gpg && flatpak remote-add --if-not-exists --user --gpg-import=/tmp/messenger.gpg messenger https://apotenza92.github.io/facebook-messenger-desktop/flatpak/repo && flatpak install --user messenger com.facebook.messenger.desktop",
                        noDownload: true,
                    },
                },
            };

            let currentLinuxArch = "x64";
            let currentLinuxFormat = "appimage";

            function setLinuxArch(arch) {
                currentLinuxArch = arch;
                const x64Btn = document.getElementById("arch-x64");
                const arm64Btn = document.getElementById("arch-arm64");

                if (arch === "arm64") {
                    x64Btn.classList.remove("active");
                    arm64Btn.classList.add("active");
                } else {
                    x64Btn.classList.add("active");
                    arm64Btn.classList.remove("active");
                }

                // Update format button states (some disabled for ARM64)
                document.querySelectorAll(".format-btn").forEach((btn) => {
                    const format = btn.getAttribute("data-format");
                    const formatData = linuxFormats[arch][format];
                    if (formatData && formatData.disabled) {
                        btn.classList.add("disabled");
                    } else {
                        btn.classList.remove("disabled");
                    }
                });

                // If current format is disabled, switch to appimage
                const currentFormatData =
                    linuxFormats[arch][currentLinuxFormat];
                if (currentFormatData && currentFormatData.disabled) {
                    setLinuxFormat("appimage");
                } else {
                    updateLinuxFormatDisplay();
                }

                setTimeout(updateConnectors, 0);
            }

            function setLinuxFormat(format) {
                currentLinuxFormat = format;

                // Update button states
                document.querySelectorAll(".format-btn").forEach((btn) => {
                    btn.classList.remove("active");
                    if (btn.getAttribute("data-format") === format) {
                        btn.classList.add("active");
                    }
                });

                updateLinuxFormatDisplay();
                setTimeout(updateConnectors, 0);
            }

            function updateLinuxFormatDisplay() {
                const formatData =
                    linuxFormats[currentLinuxArch][currentLinuxFormat];
                const downloadBtn =
                    document.getElementById("linux-download-btn");
                const btnText = document.getElementById("linux-btn-text");
                const commandLabel = document.getElementById(
                    "linux-command-label",
                );
                const commandCode =
                    document.getElementById("linux-command-code");
                const formatNote = document.getElementById("linux-format-note");
                const commandSection = document.querySelector(
                    ".linux-command-section",
                );

                if (formatData.disabled) {
                     downloadBtn.style.display = "none";
                     commandSection.style.display = "none";
                     formatNote.style.display = "block";
                     formatNote.innerHTML = `<div>${formatData.note}</div><button id="switch-to-stable-btn" style="margin-top: 0.5rem; padding: 0.3rem 0.75rem; font-size: 0.7rem; background: #0084ff; color: white; border: none; border-radius: 6px; cursor: pointer;">Switch to Stable</button>`;
                     // Add event listener for the switch button
                     const switchBtn = document.getElementById("switch-to-stable-btn");
                     if (switchBtn) {
                         switchBtn.addEventListener("click", () => switchChannel("stable"));
                     }
                } else {
                    formatNote.style.display = "none";
                    commandSection.style.display = "block";
                    commandLabel.textContent = formatData.label;
                    commandCode.textContent = formatData.command;

                    if (formatData.noDownload) {
                        downloadBtn.style.display = "none";
                    } else {
                        downloadBtn.style.display = "flex";
                        downloadBtn.href = formatData.url;
                        // Add Beta suffix to button text if in beta mode
                        const suffix = getBetaSuffix();
                        const baseText = formatData.btnText;
                        btnText.textContent = suffix ? baseText.replace("Download", "Download Beta") : baseText;
                        if (formatData.external) {
                            downloadBtn.target = "_blank";
                        } else {
                            downloadBtn.removeAttribute("target");
                        }
                    }
                }
            }

            function setWindowsArch(arch) {
                const x64Btn = document.getElementById("windows-arch-x64");
                const arm64Btn = document.getElementById("windows-arch-arm64");
                const btn = document.getElementById("download-btn");
                const btnText = document.getElementById("btn-text");

                // Update button states
                const suffix = getBetaSuffix();
                if (arch === "arm64") {
                    x64Btn.classList.remove("active");
                    arm64Btn.classList.add("active");
                    btn.href = downloads["windows-arm"].url;
                    btnText.textContent = `Download${suffix} ${downloads["windows-arm"].ext} (ARM64)`;
                } else {
                    x64Btn.classList.add("active");
                    arm64Btn.classList.remove("active");
                    btn.href = downloads["windows"].url;
                    btnText.textContent = `Download${suffix} ${downloads["windows"].ext} (x64)`;
                }

                setTimeout(updateConnectors, 0);
            }

            function setMacArch(arch) {
                const armBtn = document.getElementById("mac-arch-arm");
                const intelBtn = document.getElementById("mac-arch-intel");
                const btn = document.getElementById("download-btn");
                const btnText = document.getElementById("btn-text");

                // Update button states
                const suffix = getBetaSuffix();
                if (arch === "intel" || arch === "x64") {
                    armBtn.classList.remove("active");
                    intelBtn.classList.add("active");
                    btn.href = downloads["mac-intel"].url;
                    btnText.textContent = `Download${suffix} ${downloads["mac-intel"].ext} (Intel)`;
                } else {
                    armBtn.classList.add("active");
                    intelBtn.classList.remove("active");
                    btn.href = downloads["mac-arm"].url;
                    btnText.textContent = `Download${suffix} ${downloads["mac-arm"].ext} (Apple Silicon)`;
                }

                setTimeout(updateConnectors, 0);
            }

            // Store release data globally for channel switching
            let cachedReleases = { stable: null, beta: null };
            let currentChannel = "stable";

            // Helper to get beta suffix for download button text
            function getBetaSuffix() {
                return currentChannel === "beta" ? " Beta" : "";
            }

            async function fetchReleaseInfo() {
                try {
                    // Check if we should show beta channel
                    const params = new URLSearchParams(window.location.search);
                    const channel = params.get("channel");
                    currentChannel = channel === "beta" ? "beta" : "stable";

                    // Fetch all releases to get both stable and beta
                    const response = await fetch(
                        "https://api.github.com/repos/apotenza92/facebook-messenger-desktop/releases",
                    );
                    if (!response.ok) throw new Error("Failed to fetch");
                    const releases = await response.json();

                    // Find latest stable and latest beta
                    cachedReleases.stable = releases.find(
                        (r) => !r.prerelease && !r.draft,
                    );
                    const latestBeta = releases.find(
                        (r) => r.prerelease && !r.draft,
                    );

                    // Beta channel gets the latest release (beta or stable, whichever is newer)
                    // This ensures beta users always get the newest version
                    if (latestBeta && cachedReleases.stable) {
                        const betaDate = new Date(latestBeta.published_at);
                        const stableDate = new Date(cachedReleases.stable.published_at);
                        cachedReleases.beta = betaDate > stableDate ? latestBeta : cachedReleases.stable;
                    } else {
                        cachedReleases.beta = latestBeta || cachedReleases.stable;
                    }

                    // Always show the channel toggle
                    document.getElementById("channel-toggle").style.display = "flex";

                    // Update display for current channel
                    updateChannelDisplay();

                    // Update connectors after channel toggle becomes visible
                    setTimeout(updateConnectors, 0);
                } catch (e) {
                    console.log("Could not fetch release info:", e);
                }
            }

            function updateChannelDisplay() {
                const release =
                    currentChannel === "beta"
                        ? cachedReleases.beta
                        : cachedReleases.stable;
                const stableBtn = document.getElementById("channel-stable");
                const betaBtn = document.getElementById("channel-beta");

                // Update toggle button states, body class, and icon for beta styling
                const appIcon = document.querySelector(".icon");
                const versionDisplay = document.getElementById("version-display");
                if (currentChannel === "beta") {
                    stableBtn.classList.remove("active");
                    betaBtn.classList.add("active", "beta-active");
                    document.body.classList.add("beta-mode");
                    if (appIcon) {
                        appIcon.src = "https://raw.githubusercontent.com/apotenza92/facebook-messenger-desktop/main/assets/icons/beta/icon-rounded.png";
                    }
                } else {
                    stableBtn.classList.add("active");
                    betaBtn.classList.remove("active", "beta-active");
                    document.body.classList.remove("beta-mode");
                    if (appIcon) {
                        appIcon.src = "https://raw.githubusercontent.com/apotenza92/facebook-messenger-desktop/main/assets/icons/icon-rounded.png";
                    }
                }

                // Update version display
                if (versionDisplay && release) {
                    versionDisplay.textContent = release.tag_name;
                    versionDisplay.classList.add("visible");
                    versionDisplay.classList.remove("stable", "beta");
                    versionDisplay.classList.add(currentChannel === "beta" ? "beta" : "stable");
                }

                // Update download URLs based on selected channel's release
                if (currentChannel === "beta" && cachedReleases.beta) {
                    updateDownloadUrlsForBeta(cachedReleases.beta.tag_name);
                } else {
                    resetDownloadUrlsToStable();
                }

            }

            function switchChannel(channel) {
                if (channel === currentChannel) return;
                if (channel === "beta" && !cachedReleases.beta) return;
                currentChannel = channel;
                updateChannelDisplay();
                // Re-select platform to refresh download buttons
                if (currentPlatform) {
                    selectPlatform(currentPlatform);
                }
                setTimeout(updateConnectors, 0);
            }

            function updateDownloadUrlsForBeta(betaVersion) {
                // Update all download URLs to use beta version instead of 'latest'
                // Beta builds use different artifact names: Messenger-Beta-* instead of Messenger-*
                const baseUrl = `https://github.com/apotenza92/facebook-messenger-desktop/releases/download/${betaVersion}/`;

                // Update downloads object - beta uses "Messenger-Beta-*" artifact names
                downloads["mac-arm"].url =
                    baseUrl + "Messenger-Beta-macos-arm64.zip";
                downloads["mac-intel"].url =
                    baseUrl + "Messenger-Beta-macos-x64.zip";
                downloads["windows"].url =
                    baseUrl + "Messenger-Beta-windows-x64-setup.exe";
                downloads["windows-arm"].url =
                    baseUrl + "Messenger-Beta-windows-arm64-setup.exe";
                // Linux beta uses "facebook-messenger-desktop-beta-*" artifact names
                downloads["linux"].url =
                    baseUrl + "facebook-messenger-desktop-beta-x86_64.AppImage";
                downloads["linux-arm"].url =
                    baseUrl + "facebook-messenger-desktop-beta-arm64.AppImage";

                // Update Linux formats with beta artifact names
                const betaLinuxFormats = {
                    x64: {
                        appimage: {
                            url: baseUrl + "facebook-messenger-desktop-beta-x86_64.AppImage",
                            command: `wget -qO facebook-messenger-desktop-beta-x86_64.AppImage ${baseUrl}facebook-messenger-desktop-beta-x86_64.AppImage && chmod +x facebook-messenger-desktop-beta-x86_64.AppImage && ./facebook-messenger-desktop-beta-x86_64.AppImage`,
                        },
                        deb: {
                            url: baseUrl + "facebook-messenger-desktop-beta-amd64.deb",
                            command: `wget -qO facebook-messenger-desktop-beta-amd64.deb ${baseUrl}facebook-messenger-desktop-beta-amd64.deb && sudo apt install ./facebook-messenger-desktop-beta-amd64.deb`,
                        },
                        rpm: {
                            url: baseUrl + "facebook-messenger-desktop-beta-x86_64.rpm",
                            command: `wget -qO facebook-messenger-desktop-beta-x86_64.rpm ${baseUrl}facebook-messenger-desktop-beta-x86_64.rpm && sudo dnf install ./facebook-messenger-desktop-beta-x86_64.rpm`,
                        },
                    },
                    arm64: {
                        appimage: {
                            url: baseUrl + "facebook-messenger-desktop-beta-arm64.AppImage",
                            command: `wget -qO facebook-messenger-desktop-beta-arm64.AppImage ${baseUrl}facebook-messenger-desktop-beta-arm64.AppImage && chmod +x facebook-messenger-desktop-beta-arm64.AppImage && ./facebook-messenger-desktop-beta-arm64.AppImage`,
                        },
                        deb: {
                            url: baseUrl + "facebook-messenger-desktop-beta-arm64.deb",
                            command: `wget -qO facebook-messenger-desktop-beta-arm64.deb ${baseUrl}facebook-messenger-desktop-beta-arm64.deb && sudo apt install ./facebook-messenger-desktop-beta-arm64.deb`,
                        },
                        rpm: {
                            url: baseUrl + "facebook-messenger-desktop-beta-aarch64.rpm",
                            command: `wget -qO facebook-messenger-desktop-beta-aarch64.rpm ${baseUrl}facebook-messenger-desktop-beta-aarch64.rpm && sudo dnf install ./facebook-messenger-desktop-beta-aarch64.rpm`,
                        },
                    },
                };

                Object.keys(betaLinuxFormats).forEach((arch) => {
                    Object.keys(betaLinuxFormats[arch]).forEach((format) => {
                        if (linuxFormats[arch] && linuxFormats[arch][format]) {
                            linuxFormats[arch][format].url = betaLinuxFormats[arch][format].url;
                            linuxFormats[arch][format].command = betaLinuxFormats[arch][format].command;
                        }
                    });
                });

                // Update Snap to use beta channel
                 if (linuxFormats.x64 && linuxFormats.x64.snap) {
                     linuxFormats.x64.snap.command =
                         "sudo snap install facebook-messenger-desktop --beta";
                     linuxFormats.x64.snap.label = "Or install Snap via terminal (Beta):";
                 }
                 if (linuxFormats.arm64 && linuxFormats.arm64.snap) {
                     linuxFormats.arm64.snap.command =
                         "sudo snap install facebook-messenger-desktop --beta";
                     linuxFormats.arm64.snap.label = "Or install Snap via terminal (Beta):";
                 }

                 // Mark Flatpak as disabled for beta (no beta flatpak repo available)
                 if (linuxFormats.x64 && linuxFormats.x64.flatpak) {
                     linuxFormats.x64.flatpak.disabled = true;
                     linuxFormats.x64.flatpak.note = "Flatpak beta builds coming soon. Use stable version or another format.";
                 }
                 if (linuxFormats.arm64 && linuxFormats.arm64.flatpak) {
                     linuxFormats.arm64.flatpak.disabled = true;
                     linuxFormats.arm64.flatpak.note = "Flatpak beta builds coming soon. Use stable version or another format.";
                 }

                 // Update macOS Homebrew command and label for beta
                const homebrewCode = document.getElementById("mac-homebrew-code");
                const homebrewLabel = document.getElementById("mac-homebrew-label");
                if (homebrewCode) {
                    homebrewCode.textContent =
                        "brew install --cask apotenza92/tap/facebook-messenger-desktop@beta";
                }
                if (homebrewLabel) {
                    homebrewLabel.textContent = "Or install via Homebrew (Beta):";
                }

                // Re-initialize the current selection to update the UI
                if (currentPlatform) {
                    selectPlatform(currentPlatform);
                }
            }

            function resetDownloadUrlsToStable() {
                // Reset all download URLs back to 'latest'
                downloads["mac-arm"].url =
                    "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-macos-arm64.zip";
                downloads["mac-intel"].url =
                    "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-macos-x64.zip";
                downloads["windows"].url =
                    "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-windows-x64-setup.exe";
                downloads["windows-arm"].url =
                    "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-windows-arm64-setup.exe";
                downloads["linux"].url =
                    "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage";
                downloads["linux-arm"].url =
                    "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage";

                // Reset Linux formats
                const stableFormats = {
                    x64: {
                        appimage: {
                            url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage",
                            command:
                                "wget -qO facebook-messenger-desktop-x86_64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage && chmod +x facebook-messenger-desktop-x86_64.AppImage && ./facebook-messenger-desktop-x86_64.AppImage",
                        },
                        deb: {
                            url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-amd64.deb",
                            command:
                                "wget -qO facebook-messenger-desktop-amd64.deb https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-amd64.deb && sudo apt install ./facebook-messenger-desktop-amd64.deb",
                        },
                        rpm: {
                            url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.rpm",
                            command:
                                "wget -qO facebook-messenger-desktop-x86_64.rpm https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.rpm && sudo dnf install ./facebook-messenger-desktop-x86_64.rpm",
                        },
                    },
                    arm64: {
                        appimage: {
                            url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage",
                            command:
                                "wget -qO facebook-messenger-desktop-arm64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage && chmod +x facebook-messenger-desktop-arm64.AppImage && ./facebook-messenger-desktop-arm64.AppImage",
                        },
                        deb: {
                            url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.deb",
                            command:
                                "wget -qO facebook-messenger-desktop-arm64.deb https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.deb && sudo apt install ./facebook-messenger-desktop-arm64.deb",
                        },
                        rpm: {
                            url: "https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-aarch64.rpm",
                            command:
                                "wget -qO facebook-messenger-desktop-aarch64.rpm https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-aarch64.rpm && sudo dnf install ./facebook-messenger-desktop-aarch64.rpm",
                        },
                    },
                };

                Object.keys(stableFormats).forEach((arch) => {
                    Object.keys(stableFormats[arch]).forEach((format) => {
                        if (linuxFormats[arch] && linuxFormats[arch][format]) {
                            linuxFormats[arch][format].url =
                                stableFormats[arch][format].url;
                            linuxFormats[arch][format].command =
                                stableFormats[arch][format].command;
                        }
                    });
                });

                // Reset Snap to stable channel
                if (linuxFormats.x64 && linuxFormats.x64.snap) {
                    linuxFormats.x64.snap.command =
                        "sudo snap install facebook-messenger-desktop";
                    linuxFormats.x64.snap.label = "Or install Snap via terminal:";
                }
                if (linuxFormats.arm64 && linuxFormats.arm64.snap) {
                    linuxFormats.arm64.snap.command =
                        "sudo snap install facebook-messenger-desktop";
                    linuxFormats.arm64.snap.label = "Or install Snap via terminal:";
                }

                // Reset macOS Homebrew command and label to stable
                const homebrewCode = document.getElementById("mac-homebrew-code");
                const homebrewLabel = document.getElementById("mac-homebrew-label");
                if (homebrewCode) {
                    homebrewCode.textContent =
                        "brew install --cask apotenza92/tap/facebook-messenger-desktop";
                }
                if (homebrewLabel) {
                    homebrewLabel.textContent = "Or install via Homebrew:";
                }
            }

            function getActualPlatform() {
                // Get the actual platform without URL override
                const ua = navigator.userAgent.toLowerCase();
                const platform = navigator.platform?.toLowerCase() || "";

                if (ua.includes("win")) {
                    return "windows";
                }
                if (ua.includes("mac")) {
                    return "mac-arm"; // or mac-intel, but we'll treat all macOS the same for "Other platforms"
                }
                if (ua.includes("linux") && !ua.includes("android")) {
                    return "linux";
                }
                return "windows";
            }

            function selectPlatform(platform) {
                const btn = document.getElementById("download-btn");
                const btnText = document.getElementById("btn-text");
                const downloadWrapper =
                    document.getElementById("download-wrapper");
                const linuxFormats = document.getElementById("linux-formats");
                const windowsArchToggle = document.getElementById(
                    "windows-arch-toggle",
                );
                const macArchToggle =
                    document.getElementById("mac-arch-toggle");
                const macHomebrewSection = document.getElementById(
                    "mac-homebrew-section",
                );

                // Update platform toggle button states
                document
                    .querySelectorAll(".platform-btn")
                    .forEach((b) => b.classList.remove("active"));

                if (
                    platform === "mac" ||
                    platform === "mac-arm" ||
                    platform === "mac-intel"
                ) {
                    document
                        .getElementById("platform-btn-mac")
                        .classList.add("active");
                    currentPlatform = "mac-arm";

                    // Show download wrapper, hide Linux formats
                    downloadWrapper.style.display = "flex";
                    linuxFormats.classList.remove("visible");
                    macArchToggle.style.display = "block";
                    windowsArchToggle.style.display = "none";
                    macHomebrewSection.style.display = "block";

                    // Determine initial architecture
                    const urlArch = getArchFromURL();
                    let initialArch = "arm";
                    if (urlArch === "intel" || urlArch === "x64") {
                        initialArch = "intel";
                    } else if (!urlArch) {
                        const actualPlatform = getActualPlatform();
                        if (actualPlatform === "mac-intel") {
                            initialArch = "intel";
                        }
                    }
                    setMacArch(initialArch);
                } else if (
                    platform === "windows" ||
                    platform === "windows-arm"
                ) {
                    document
                        .getElementById("platform-btn-windows")
                        .classList.add("active");
                    currentPlatform = "windows";

                    // Show download wrapper, hide Linux formats
                    downloadWrapper.style.display = "flex";
                    linuxFormats.classList.remove("visible");
                    windowsArchToggle.style.display = "block";
                    macArchToggle.style.display = "none";
                    macHomebrewSection.style.display = "none";

                    // Determine initial architecture
                    const urlArch = getArchFromURL();
                    let initialArch = "x64";
                    if (urlArch === "arm64") {
                        initialArch = "arm64";
                    } else if (!urlArch) {
                        const actualPlatform = getActualPlatform();
                        if (actualPlatform === "windows") {
                            const ua = navigator.userAgent.toLowerCase();
                            if (ua.includes("arm") || ua.includes("aarch64")) {
                                initialArch = "arm64";
                            }
                        }
                    }
                    setWindowsArch(initialArch);
                } else {
                    // Linux
                    document
                        .getElementById("platform-btn-linux")
                        .classList.add("active");
                    currentPlatform = "linux";

                    // Hide download wrapper, show Linux formats
                    downloadWrapper.style.display = "none";
                    linuxFormats.classList.add("visible");
                    windowsArchToggle.style.display = "none";
                    macArchToggle.style.display = "none";
                    macHomebrewSection.style.display = "none";

                    // Determine initial architecture
                    const urlArch = getArchFromURL();
                    if (urlArch === "arm64") {
                        setLinuxArch("arm64");
                    } else {
                        setLinuxArch("x64");
                    }
                }

                // Keep URL clean - no query params
                window.history.replaceState({}, "", window.location.pathname);

                setTimeout(updateConnectors, 0);
            }

            function init() {
                // Determine initial platform: URL param > auto-detect
                const urlPlatform = getPlatformFromURL();
                let initialPlatform;

                if (urlPlatform) {
                    initialPlatform = urlPlatform;
                } else {
                    // Auto-detect
                    const detected = detectPlatform();
                    if (detected === "mac-arm" || detected === "mac-intel") {
                        initialPlatform = "mac";
                    } else if (
                        detected === "linux" ||
                        detected === "linux-arm"
                    ) {
                        initialPlatform = "linux";
                    } else {
                        initialPlatform = "windows";
                    }
                }

                selectPlatform(initialPlatform);

                // Channel toggle buttons
                document
                    .getElementById("channel-stable")
                    .addEventListener("click", () => switchChannel("stable"));
                document
                    .getElementById("channel-beta")
                    .addEventListener("click", () => switchChannel("beta"));

                // Platform toggle buttons
                document
                    .getElementById("platform-btn-mac")
                    .addEventListener("click", () => selectPlatform("mac"));
                document
                    .getElementById("platform-btn-windows")
                    .addEventListener("click", () => selectPlatform("windows"));
                document
                    .getElementById("platform-btn-linux")
                    .addEventListener("click", () => selectPlatform("linux"));

                // Linux arch toggle buttons
                document
                    .getElementById("arch-x64")
                    .addEventListener("click", () => setLinuxArch("x64"));
                document
                    .getElementById("arch-arm64")
                    .addEventListener("click", () => setLinuxArch("arm64"));

                // Linux format toggle buttons
                 document.querySelectorAll(".format-btn").forEach((btn) => {
                     btn.addEventListener("click", () => {
                         const format = btn.getAttribute("data-format");
                         const formatData =
                             linuxFormats[currentLinuxArch][format];
                         if (!formatData) return;
                         // Allow disabled formats to be selected so the message displays
                         setLinuxFormat(format);
                     });
                 });

                // Linux copy button
                document
                    .getElementById("linux-copy-btn")
                    .addEventListener("click", () => {
                        const code =
                            document.getElementById(
                                "linux-command-code",
                            ).textContent;
                        navigator.clipboard.writeText(code);
                        const copyBtn =
                            document.getElementById("linux-copy-btn");
                        copyBtn.innerHTML =
                            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
                        setTimeout(() => {
                            copyBtn.innerHTML =
                                '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>';
                        }, 2000);
                    });

                // macOS Homebrew copy button - copies the currently displayed command
                document
                    .getElementById("mac-homebrew-copy")
                    .addEventListener("click", () => {
                        const code = document.getElementById("mac-homebrew-code").textContent;
                        navigator.clipboard.writeText(code);
                        const copyBtn =
                            document.getElementById("mac-homebrew-copy");
                        copyBtn.innerHTML =
                            '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
                        setTimeout(() => {
                            copyBtn.innerHTML =
                                '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>';
                        }, 2000);
                    });

                // Windows arch toggle buttons
                document
                    .getElementById("windows-arch-x64")
                    .addEventListener("click", () => setWindowsArch("x64"));
                document
                    .getElementById("windows-arch-arm64")
                    .addEventListener("click", () => setWindowsArch("arm64"));

                // macOS arch toggle buttons
                document
                    .getElementById("mac-arch-arm")
                    .addEventListener("click", () => setMacArch("arm"));
                document
                    .getElementById("mac-arch-intel")
                    .addEventListener("click", () => setMacArch("intel"));

                // Download button animation
                const btn = document.getElementById("download-btn");
                btn.addEventListener("click", () => {
                    btn.classList.add("downloading");
                    const btnText = document.getElementById("btn-text");
                    const originalText = btnText.textContent;
                    btnText.textContent = "Starting...";
                    setTimeout(() => {
                        btn.classList.remove("downloading");
                        btnText.textContent = originalText;
                    }, 2000);
                });

                // Copy buttons
                document.querySelectorAll(".copy-btn").forEach((btn) => {
                    btn.addEventListener("click", async () => {
                        const code =
                            btn.parentElement.querySelector("code").textContent;
                        try {
                            await navigator.clipboard.writeText(code);
                            btn.classList.add("copied");
                            setTimeout(
                                () => btn.classList.remove("copied"),
                                1500,
                            );
                        } catch (e) {
                            console.error("Failed to copy:", e);
                        }
                    });
                });

                fetchReleaseInfo();
            }

            init();

            // Update connectors on resize
            window.addEventListener("resize", () => {
                requestAnimationFrame(updateConnectors);
            });
        </script>
    </body>
</html>
