<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Download Messenger Desktop</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      --bg: #ffffff;
      --bg-gradient: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%);
      --text: #1a1a1a;
      --text-muted: #666;
      --text-subtle: #888;
      --border: #e0e0e0;
      --btn-shadow: rgba(0, 132, 255, 0.25);
      --btn-shadow-hover: rgba(0, 132, 255, 0.35);
      --code-bg: #f4f4f4;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0a0a0a;
        --bg-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0f0f23 100%);
        --text: #ffffff;
        --text-muted: #888;
        --text-subtle: #666;
        --border: #333;
        --btn-shadow: rgba(0, 132, 255, 0.3);
        --btn-shadow-hover: rgba(0, 132, 255, 0.4);
        --code-bg: #1a1a1a;
      }
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
    }
    
    .container {
      text-align: center;
      padding: 2rem;
      max-width: 600px;
    }
    
    .icon {
      width: 96px;
      height: 96px;
      margin-bottom: 1.5rem;
      border-radius: 20px;
    }
    
    h1 {
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .download-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      background: #0084ff;
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.2s ease;
      box-shadow: 0 4px 20px var(--btn-shadow);
    }
    
    .download-btn:hover {
      background: #0073e6;
      transform: translateY(-2px);
      box-shadow: 0 6px 25px var(--btn-shadow-hover);
    }
    
    .download-btn svg {
      width: 20px;
      height: 20px;
    }
    
    .download-wrapper {
      display: flex;
      align-items: center;
      justify-content: center;
    }
    
    .platform {
      margin-bottom: 1.5rem;
      color: var(--text-muted);
      font-size: 0.95rem;
    }
    
    .other-platforms {
      margin-top: 2.5rem;
      padding-top: 2rem;
      border-top: 1px solid var(--border);
    }
    
    .other-platforms h2 {
      font-size: 0.9rem;
      font-weight: 500;
      color: var(--text-muted);
      margin-bottom: 1rem;
    }
    
    .platform-links {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      justify-content: center;
    }
    
    .platform-link {
      color: #0084ff;
      text-decoration: none;
      font-size: 0.85rem;
      padding: 0.5rem 1rem;
      border: 1px solid var(--border);
      border-radius: 8px;
      transition: all 0.2s ease;
    }
    
    .platform-link:hover {
      background: rgba(0, 132, 255, 0.1);
      border-color: #0084ff;
    }
    
    .platform-link.hidden {
      display: none;
    }
    
    .github-link {
      margin-top: 2rem;
      color: var(--text-subtle);
      font-size: 0.8rem;
    }
    
    .github-link a {
      color: var(--text-muted);
      text-decoration: none;
    }
    
    .github-link a:hover {
      color: var(--text);
    }
    
    .linux-formats {
      display: none;
      margin-top: 1.5rem;
      text-align: left;
    }
    
    .linux-formats.visible {
      display: block;
    }
    
    .linux-formats h3 {
      font-size: 0.9rem;
      font-weight: 600;
      color: var(--text);
      margin-bottom: 1rem;
      text-align: center;
    }
    
    .linux-arch-toggle,
    .windows-arch-toggle,
    .mac-arch-toggle {
      text-align: center;
      margin-bottom: 1rem;
    }
    
    .arch-btn {
      background: none;
      border: 1px solid var(--border);
      padding: 0.4rem 1rem;
      font-size: 0.8rem;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.2s ease;
    }
    
    .arch-btn:first-child {
      border-radius: 6px 0 0 6px;
    }
    
    .arch-btn:last-child {
      border-radius: 0 6px 6px 0;
      border-left: none;
    }
    
    .arch-btn.active {
      background: #0084ff;
      border-color: #0084ff;
      color: white;
    }
    
    .format-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .format-section-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 0.5rem;
      margin-bottom: -0.25rem;
    }
    
    .format-section-label:first-child {
      margin-top: 0;
    }
    
    .command-label {
      font-size: 0.7rem;
      color: var(--text-subtle);
      margin-bottom: 0.25rem;
    }
    
    .format-item {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem;
      text-align: left;
    }
    
    .format-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .format-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .format-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text);
    }
    
    .format-desc {
      font-size: 0.75rem;
      color: var(--text-muted);
      background: var(--border);
      padding: 0.15rem 0.5rem;
      border-radius: 4px;
    }
    
    .format-download {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      color: #0084ff;
      text-decoration: none;
      font-size: 0.8rem;
      font-weight: 500;
      padding: 0.3rem 0.75rem;
      border: 1px solid #0084ff;
      border-radius: 6px;
      transition: all 0.2s ease;
    }
    
    .format-download:hover {
      background: #0084ff;
      color: white;
    }
    
    .format-download .ext {
      opacity: 1;
      font-weight: 400;
    }
    
    .format-download:hover .ext {
      opacity: 1;
    }
    
    .format-command {
      display: flex;
      align-items: center;
      background: var(--bg);
      border: 1px solid var(--border);
      border-radius: 6px;
      font-family: "SF Mono", "Monaco", "Consolas", monospace;
      font-size: 0.75rem;
      color: var(--text-muted);
      position: relative;
    }
    
    .format-command code {
      flex: 1;
      white-space: nowrap;
      overflow-x: auto;
      padding: 0.5rem 0.75rem;
      padding-right: 2.5rem;
    }
    
    .copy-btn {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      background: linear-gradient(to right, transparent, var(--bg) 30%);
      border: none;
      cursor: pointer;
      padding: 0.25rem 0.5rem 0.25rem 1.5rem;
      color: var(--text-muted);
      transition: color 0.2s ease;
      display: flex;
      align-items: center;
    }
    
    .copy-btn:hover {
      color: #0084ff;
    }
    
    .copy-btn svg {
      width: 14px;
      height: 14px;
    }
    
    .copy-btn.copied {
      color: #22c55e;
    }
    
    .format-pending {
      font-size: 0.7rem;
      color: #f59e0b;
      padding: 0.2rem 0.5rem;
      border: 1px solid #f59e0b;
      border-radius: 4px;
    }
    
    .format-command.format-disabled {
      opacity: 0.5;
    }

    .version-info {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-top: 1rem;
      font-size: 0.85rem;
      color: var(--text-muted);
    }
    
    .version-info span {
      display: flex;
      align-items: center;
      gap: 0.35rem;
    }
    
    .version-badge {
      background: rgba(0, 132, 255, 0.1);
      color: #0084ff;
      padding: 0.25rem 0.6rem;
      border-radius: 6px;
      font-weight: 500;
      font-size: 0.8rem;
    }
    
    .version-info svg {
      width: 14px;
      height: 14px;
      opacity: 0.7;
    }
    
    .release-notes {
      margin-top: 0.75rem;
    }
    
    .release-notes a {
      color: var(--text-muted);
      text-decoration: none;
      font-size: 0.8rem;
    }
    
    .release-notes a:hover {
      color: #0084ff;
      text-decoration: underline;
    }
    
    .spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .downloading .spinner { display: block; }
    .downloading .download-icon { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://raw.githubusercontent.com/apotenza92/facebook-messenger-desktop/main/assets/icons/icon-rounded.png" alt="Messenger" class="icon">
    <h1>Messenger Desktop (Unofficial)</h1>
    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 1rem; margin-bottom: 1rem;">This is an unofficial third-party desktop application for Facebook Messenger, created because the official app was deprecated.</p>
    <p class="platform" id="platform-text">Detecting your platform...</p>
    
    <div class="download-wrapper" id="download-wrapper">
      <div class="windows-arch-toggle" id="windows-arch-toggle" style="display: none;">
        <button class="arch-btn active" id="windows-arch-x64">x64</button>
        <button class="arch-btn" id="windows-arch-arm64">ARM64</button>
      </div>
      <div class="mac-arch-toggle" id="mac-arch-toggle" style="display: none;">
        <button class="arch-btn active" id="mac-arch-arm">Apple Silicon</button>
        <button class="arch-btn" id="mac-arch-intel">Intel</button>
      </div>
      <a href="#" class="download-btn" id="download-btn">
        <svg class="download-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
        </svg>
        <div class="spinner"></div>
        <span id="btn-text">Download</span>
      </a>
    </div>
    
    <div class="linux-formats" id="linux-formats">
      <h3>Linux Downloads</h3>
      
      <div class="linux-arch-toggle">
        <button class="arch-btn active" id="arch-x64">x64</button>
        <button class="arch-btn" id="arch-arm64">ARM64</button>
      </div>
      
      <div class="format-list" id="format-list-x64">
        <div class="format-item">
          <div class="format-header">
            <span class="format-name">AppImage</span>
            <a href="https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage" class="format-download">Download <span class="ext">.AppImage</span></a>
          </div>
          <div class="command-label">Download & run via terminal:</div>
          <div class="format-command">
            <code>wget -qO facebook-messenger-desktop-x86_64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage && chmod +x facebook-messenger-desktop-x86_64.AppImage && ./facebook-messenger-desktop-x86_64.AppImage</code>
            <button class="copy-btn" title="Copy command">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
        
        <div class="format-item">
          <div class="format-header">
            <span class="format-name">Ubuntu / Debian</span>
            <a href="https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-amd64.deb" class="format-download">Download <span class="ext">.deb</span></a>
          </div>
          <div class="command-label">Download & install via terminal:</div>
          <div class="format-command">
            <code>wget -qO facebook-messenger-desktop-amd64.deb https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-amd64.deb && sudo apt install ./facebook-messenger-desktop-amd64.deb</code>
            <button class="copy-btn" title="Copy command">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
        
        <div class="format-item">
          <div class="format-header">
            <span class="format-name">Fedora / RHEL</span>
            <a href="https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.rpm" class="format-download">Download <span class="ext">.rpm</span></a>
          </div>
          <div class="command-label">Download & install via terminal:</div>
          <div class="format-command">
            <code>wget -qO facebook-messenger-desktop-x86_64.rpm https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.rpm && sudo dnf install ./facebook-messenger-desktop-x86_64.rpm</code>
            <button class="copy-btn" title="Copy command">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
        
        <div class="format-item">
          <div class="format-header">
            <span class="format-name">Snap</span>
            <a href="https://snapcraft.io/facebook-messenger-desktop" class="format-download" target="_blank">View in Store</a>
          </div>
          <div class="command-label">Install via terminal:</div>
          <div class="format-command">
            <code>sudo snap install facebook-messenger-desktop</code>
            <button class="copy-btn" title="Copy command">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
        
        <div class="format-item">
          <div class="format-header">
            <span class="format-name">Flatpak</span>
          </div>
          <div class="command-label">Add repository & install:</div>
          <div class="format-command">
            <code>flatpak remote-add --if-not-exists --user messenger https://apotenza92.github.io/facebook-messenger-desktop/flatpak/repo && flatpak install --user messenger com.facebook.messenger.desktop</code>
            <button class="copy-btn" title="Copy command">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
      </div>
      
      <div class="format-list" id="format-list-arm64" style="display: none;">
        <div class="format-item">
          <div class="format-header">
            <span class="format-name">AppImage</span>
            <a href="https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage" class="format-download">Download <span class="ext">.AppImage</span></a>
          </div>
          <div class="command-label">Download & run via terminal:</div>
          <div class="format-command">
            <code>wget -qO facebook-messenger-desktop-arm64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage && chmod +x facebook-messenger-desktop-arm64.AppImage && ./facebook-messenger-desktop-arm64.AppImage</code>
            <button class="copy-btn" title="Copy command">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
        
        <div class="format-item">
          <div class="format-header">
            <span class="format-name">Ubuntu / Debian</span>
            <a href="https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.deb" class="format-download">Download <span class="ext">.deb</span></a>
          </div>
          <div class="command-label">Download & install via terminal:</div>
          <div class="format-command">
            <code>wget -qO facebook-messenger-desktop-arm64.deb https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.deb && sudo apt install ./facebook-messenger-desktop-arm64.deb</code>
            <button class="copy-btn" title="Copy command">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
        
        <div class="format-item">
          <div class="format-header">
            <span class="format-name">Fedora / RHEL</span>
            <a href="https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-aarch64.rpm" class="format-download">Download <span class="ext">.rpm</span></a>
          </div>
          <div class="command-label">Download & install via terminal:</div>
          <div class="format-command">
            <code>wget -qO facebook-messenger-desktop-aarch64.rpm https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-aarch64.rpm && sudo dnf install ./facebook-messenger-desktop-aarch64.rpm</code>
            <button class="copy-btn" title="Copy command">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
        
        <div class="format-item" style="opacity: 0.6;">
          <div class="format-header">
            <span class="format-name">Flatpak</span>
            <span class="format-desc">x64 only</span>
          </div>
          <div class="command-label">Flatpak is only available for x64. Switch to x64 tab above for Flatpak installation.</div>
        </div>
      </div>
    </div>
    
    <div class="version-info" id="version-info">
      <span>
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
        </svg>
        Version <span class="version-badge" id="version-badge">...</span>
      </span>
      <span id="release-date"></span>
    </div>
    <div class="release-notes" id="release-notes"></div>
    
    <div class="other-platforms">
      <h2>Other platforms</h2>
      <div class="platform-links" id="platform-links">
        <a href="?platform=mac" class="platform-link" data-platform="mac">macOS</a>
        <a href="?platform=windows" class="platform-link" data-platform="windows">Windows</a>
        <a href="?platform=linux" class="platform-link" data-platform="linux">Linux</a>
      </div>
    </div>
    
    <p class="github-link">
      <a href="https://github.com/apotenza92/facebook-messenger-desktop">View on GitHub</a>
    </p>
    <p style="font-size: 0.7rem; color: var(--text-subtle); margin-top: 1.5rem; max-width: 500px; margin-left: auto; margin-right: auto; line-height: 1.4;">
      <strong>Trademark Notice:</strong> This project is not affiliated with, endorsed by, or connected to Facebook, Inc. or Meta Platforms, Inc. "Facebook" and "Messenger" are trademarks of Meta Platforms, Inc. This is an independent, open-source project.
    </p>
  </div>

  <script>
    const downloads = {
      'mac-arm': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-macos-arm64.zip',
        name: 'macOS (Apple Silicon)',
        file: 'Messenger-macos-arm64.zip',
        ext: '.zip'
      },
      'mac-intel': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-macos-x64.zip',
        name: 'macOS (Intel)',
        file: 'Messenger-macos-x64.zip',
        ext: '.zip'
      },
      'windows': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-windows-x64-setup.exe',
        name: 'Windows',
        file: 'Messenger-windows-x64-setup.exe',
        ext: '.exe'
      },
      'windows-arm': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-windows-arm64-setup.exe',
        name: 'Windows (ARM)',
        file: 'Messenger-windows-arm64-setup.exe',
        ext: '.exe'
      },
      'linux': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage',
        name: 'Linux',
        file: 'facebook-messenger-desktop-x86_64.AppImage',
        ext: '.AppImage',
        showFormats: true,
        arch: 'x64'
      },
      'linux-arm': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage',
        name: 'Linux (ARM64)',
        file: 'facebook-messenger-desktop-arm64.AppImage',
        ext: '.AppImage',
        showFormats: true,
        arch: 'arm64'
      }
    };

    let currentPlatform = null;

    function getPlatformFromURL() {
      const params = new URLSearchParams(window.location.search);
      const platformParam = params.get('platform');
      if (platformParam === 'windows') {
        return 'windows';
      } else if (platformParam === 'linux') {
        return 'linux';
      } else if (platformParam === 'mac') {
        return 'mac';
      }
      return null;
    }

    function getArchFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('arch'); // Returns 'x64', 'arm64', 'arm', 'intel', or null
    }

    function detectPlatform() {
      // Check URL parameter first
      const urlPlatform = getPlatformFromURL();
      if (urlPlatform) {
        // If platform is specified, check for architecture override
        const urlArch = getArchFromURL();
        if (urlPlatform === 'windows' && urlArch === 'arm64') {
          return 'windows-arm';
        } else if (urlPlatform === 'linux' && urlArch === 'arm64') {
          return 'linux-arm';
        } else if (urlPlatform === 'mac') {
          if (urlArch === 'intel' || urlArch === 'x64') {
            return 'mac-intel';
          } else if (urlArch === 'arm' || urlArch === 'arm64') {
            return 'mac-arm';
          }
          // If no arch specified for mac, will auto-detect below
        } else {
          return urlPlatform;
        }
      }
      
      const ua = navigator.userAgent.toLowerCase();
      const platform = navigator.platform?.toLowerCase() || '';
      
      // Check for Windows
      if (ua.includes('win')) {
        if (ua.includes('arm') || ua.includes('aarch64')) {
          return 'windows-arm';
        }
        return 'windows';
      }
      
      // Check for macOS
      if (ua.includes('mac')) {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl');
        let isAppleSilicon = false;
        
        if (gl) {
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          if (debugInfo) {
            const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            if (renderer && renderer.toLowerCase().includes('apple')) {
              isAppleSilicon = true;
            }
          }
        }
        
        if (platform.includes('arm') || ua.includes('arm64') || isAppleSilicon) {
          return 'mac-arm';
        }
        // If not Apple Silicon, it's Intel
        return 'mac-intel';
      }
      
      // Check for Linux
      if (ua.includes('linux') && !ua.includes('android')) {
        if (ua.includes('aarch64') || ua.includes('arm64') || platform.includes('arm')) {
          return 'linux-arm';
        }
        return 'linux';
      }
      
      return 'windows';
    }


    function setLinuxArch(arch) {
      const x64List = document.getElementById('format-list-x64');
      const arm64List = document.getElementById('format-list-arm64');
      const x64Btn = document.getElementById('arch-x64');
      const arm64Btn = document.getElementById('arch-arm64');
      
      if (arch === 'arm64') {
        x64List.style.display = 'none';
        arm64List.style.display = 'flex';
        x64Btn.classList.remove('active');
        arm64Btn.classList.add('active');
      } else {
        x64List.style.display = 'flex';
        arm64List.style.display = 'none';
        x64Btn.classList.add('active');
        arm64Btn.classList.remove('active');
      }
    }

    function setWindowsArch(arch) {
      const x64Btn = document.getElementById('windows-arch-x64');
      const arm64Btn = document.getElementById('windows-arch-arm64');
      const btn = document.getElementById('download-btn');
      const btnText = document.getElementById('btn-text');
      const platformText = document.getElementById('platform-text');
      
      // Update button states
      if (arch === 'arm64') {
        x64Btn.classList.remove('active');
        arm64Btn.classList.add('active');
        btn.href = downloads['windows-arm'].url;
        btnText.textContent = `Download ${downloads['windows-arm'].ext}`;
        platformText.textContent = downloads['windows-arm'].name;
      } else {
        x64Btn.classList.add('active');
        arm64Btn.classList.remove('active');
        btn.href = downloads['windows'].url;
        btnText.textContent = `Download ${downloads['windows'].ext}`;
        platformText.textContent = downloads['windows'].name;
      }
      
      // Update URL parameter
      const params = new URLSearchParams(window.location.search);
      if (arch === 'arm64') {
        params.set('arch', 'arm64');
      } else {
        params.set('arch', 'x64');
      }
      params.set('platform', 'windows');
      window.history.replaceState({}, '', '?' + params.toString());
    }

    function setMacArch(arch) {
      const armBtn = document.getElementById('mac-arch-arm');
      const intelBtn = document.getElementById('mac-arch-intel');
      const btn = document.getElementById('download-btn');
      const btnText = document.getElementById('btn-text');
      const platformText = document.getElementById('platform-text');
      
      // Update button states
      if (arch === 'intel' || arch === 'x64') {
        armBtn.classList.remove('active');
        intelBtn.classList.add('active');
        btn.href = downloads['mac-intel'].url;
        btnText.textContent = `Download ${downloads['mac-intel'].ext}`;
        platformText.textContent = downloads['mac-intel'].name;
      } else {
        armBtn.classList.add('active');
        intelBtn.classList.remove('active');
        btn.href = downloads['mac-arm'].url;
        btnText.textContent = `Download ${downloads['mac-arm'].ext}`;
        platformText.textContent = downloads['mac-arm'].name;
      }
      
      // Update URL parameter
      const params = new URLSearchParams(window.location.search);
      if (arch === 'intel' || arch === 'x64') {
        params.set('arch', 'intel');
      } else {
        params.set('arch', 'arm');
      }
      params.set('platform', 'mac');
      window.history.replaceState({}, '', '?' + params.toString());
    }

    async function fetchReleaseInfo() {
      try {
        const response = await fetch('https://api.github.com/repos/apotenza92/facebook-messenger-desktop/releases/latest');
        if (!response.ok) throw new Error('Failed to fetch');
        const release = await response.json();
        
        const versionBadge = document.getElementById('version-badge');
        versionBadge.textContent = release.tag_name || release.name;
        
        const releaseDateEl = document.getElementById('release-date');
        if (release.published_at) {
          const date = new Date(release.published_at);
          const formatted = date.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric', 
            year: 'numeric' 
          });
          releaseDateEl.innerHTML = `
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/>
            </svg>
            ${formatted}
          `;
        }
        
        const releaseNotesEl = document.getElementById('release-notes');
        releaseNotesEl.innerHTML = `<a href="${release.html_url}" target="_blank">View release notes â†’</a>`;
        
      } catch (e) {
        console.log('Could not fetch release info:', e);
        document.getElementById('version-info').style.display = 'none';
      }
    }

    function getActualPlatform() {
      // Get the actual platform without URL override
      const ua = navigator.userAgent.toLowerCase();
      const platform = navigator.platform?.toLowerCase() || '';
      
      if (ua.includes('win')) {
        return 'windows';
      }
      if (ua.includes('mac')) {
        return 'mac-arm'; // or mac-intel, but we'll treat all macOS the same for "Other platforms"
      }
      if (ua.includes('linux') && !ua.includes('android')) {
        return 'linux';
      }
      return 'windows';
    }

    function init() {
      currentPlatform = detectPlatform();
      const download = downloads[currentPlatform];
      const btn = document.getElementById('download-btn');
      const btnText = document.getElementById('btn-text');
      const downloadWrapper = document.getElementById('download-wrapper');
      const platformText = document.getElementById('platform-text');
      const linuxFormats = document.getElementById('linux-formats');
      
      // Show "Other platforms" section and hide currently viewed platform
      const platformLinks = document.querySelectorAll('.platform-link');
      platformLinks.forEach(link => {
        const linkPlatform = link.getAttribute('data-platform');
        // Hide if it matches the currently viewed platform
        if (linkPlatform === 'mac' && (currentPlatform === 'mac-arm' || currentPlatform === 'mac-intel')) {
          link.classList.add('hidden');
        } else if (linkPlatform === 'linux' && (currentPlatform === 'linux' || currentPlatform === 'linux-arm')) {
          link.classList.add('hidden');
        } else if (linkPlatform === 'windows' && (currentPlatform === 'windows' || currentPlatform === 'windows-arm')) {
          link.classList.add('hidden');
        }
      });
      
      // For Linux: hide download button, show format picker directly
      if (download.showFormats && linuxFormats) {
        downloadWrapper.style.display = 'none';
        platformText.style.display = 'none';
        linuxFormats.classList.add('visible');
        
        if (download.arch === 'arm64') {
          setLinuxArch('arm64');
        }
      } else {
        // For macOS/Windows: show download button with extension
        btn.href = download.url;
        btnText.textContent = `Download ${download.ext}`;
        platformText.textContent = download.name;
        
        const windowsArchToggle = document.getElementById('windows-arch-toggle');
        const macArchToggle = document.getElementById('mac-arch-toggle');
        
        // Show Windows architecture toggle if Windows is selected
        if (currentPlatform === 'windows' || currentPlatform === 'windows-arm') {
          if (windowsArchToggle) {
            windowsArchToggle.style.display = 'block';
          }
          if (macArchToggle) {
            macArchToggle.style.display = 'none';
          }
          // Determine initial architecture: URL param > auto-detect (if on Windows) > default to x64
          const urlArch = getArchFromURL();
          let initialArch = 'x64';
          if (urlArch === 'arm64') {
            initialArch = 'arm64';
          } else if (urlArch === 'x64') {
            initialArch = 'x64';
          } else {
            // Auto-detect: check if user is actually on Windows and detect their architecture
            const actualPlatform = getActualPlatform();
            if (actualPlatform === 'windows') {
              // User is on Windows, detect their actual architecture
              const ua = navigator.userAgent.toLowerCase();
              if (ua.includes('arm') || ua.includes('aarch64')) {
                initialArch = 'arm64';
              } else {
                initialArch = 'x64';
              }
            } else {
              // User is not on Windows, default to x64
              initialArch = 'x64';
            }
          }
          setWindowsArch(initialArch);
        } 
        // Show macOS architecture toggle if macOS is selected
        else if (currentPlatform === 'mac-arm' || currentPlatform === 'mac-intel') {
          if (macArchToggle) {
            macArchToggle.style.display = 'block';
          }
          if (windowsArchToggle) {
            windowsArchToggle.style.display = 'none';
          }
          // Determine initial architecture: URL param > auto-detect (if on macOS) > default to Apple Silicon
          const urlArch = getArchFromURL();
          let initialArch = 'arm';
          if (urlArch === 'intel' || urlArch === 'x64') {
            initialArch = 'intel';
          } else if (urlArch === 'arm' || urlArch === 'arm64') {
            initialArch = 'arm';
          } else {
            // Auto-detect: check if user is actually on macOS and detect their architecture
            const actualPlatform = getActualPlatform();
            if (actualPlatform === 'mac-arm' || actualPlatform === 'mac-intel') {
              // User is on macOS, use the detected platform
              initialArch = actualPlatform === 'mac-intel' ? 'intel' : 'arm';
            } else {
              // User is not on macOS, default to Apple Silicon
              initialArch = 'arm';
            }
          }
          setMacArch(initialArch);
        } else {
          if (windowsArchToggle) {
            windowsArchToggle.style.display = 'none';
          }
          if (macArchToggle) {
            macArchToggle.style.display = 'none';
          }
        }
        
        btn.addEventListener('click', () => {
          btn.classList.add('downloading');
          btnText.textContent = 'Starting...';
          setTimeout(() => {
            btn.classList.remove('downloading');
            btnText.textContent = `Download ${download.ext}`;
          }, 2000);
        });
      }
      
      // Linux arch toggle buttons
      document.getElementById('arch-x64').addEventListener('click', () => setLinuxArch('x64'));
      document.getElementById('arch-arm64').addEventListener('click', () => setLinuxArch('arm64'));
      
      // Windows arch toggle buttons
      document.getElementById('windows-arch-x64').addEventListener('click', () => setWindowsArch('x64'));
      document.getElementById('windows-arch-arm64').addEventListener('click', () => setWindowsArch('arm64'));
      
      // macOS arch toggle buttons
      document.getElementById('mac-arch-arm').addEventListener('click', () => setMacArch('arm'));
      document.getElementById('mac-arch-intel').addEventListener('click', () => setMacArch('intel'));
      
      // Copy buttons
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const code = btn.parentElement.querySelector('code').textContent;
          try {
            await navigator.clipboard.writeText(code);
            btn.classList.add('copied');
            setTimeout(() => btn.classList.remove('copied'), 1500);
          } catch (e) {
            console.error('Failed to copy:', e);
          }
        });
      });
      
      fetchReleaseInfo();
    }

    init();
  </script>
</body>
</html>
