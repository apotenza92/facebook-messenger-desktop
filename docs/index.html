<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="color-scheme" content="light dark">
  <title>Download Facebook Messenger Desktop</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    
    :root {
      color-scheme: light dark;
      --bg: #ffffff;
      --bg-gradient: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 50%, #f8f9fa 100%);
      --text: #1a1a1a;
      --text-muted: #666;
      --text-subtle: #888;
      --border: #e0e0e0;
      --btn-shadow: rgba(0, 132, 255, 0.25);
      --btn-shadow-hover: rgba(0, 132, 255, 0.35);
      --code-bg: #f4f4f4;
    }
    
    @media (prefers-color-scheme: dark) {
      :root {
        --bg: #0a0a0a;
        --bg-gradient: linear-gradient(135deg, #0a0a0a 0%, #1a1a2e 50%, #0f0f23 100%);
        --text: #ffffff;
        --text-muted: #888;
        --text-subtle: #666;
        --border: #333;
        --btn-shadow: rgba(0, 132, 255, 0.3);
        --btn-shadow-hover: rgba(0, 132, 255, 0.4);
        --code-bg: #1a1a1a;
      }
    }
    
    body {
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
      background: var(--bg-gradient);
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      color: var(--text);
    }
    
    .container {
      text-align: center;
      padding: 2rem;
      max-width: 600px;
    }
    
    .icon {
      width: 96px;
      height: 96px;
      margin-bottom: 1.5rem;
      border-radius: 20px;
    }
    
    h1 {
      font-size: 1.75rem;
      font-weight: 600;
      margin-bottom: 0.5rem;
    }
    
    .download-btn {
      display: inline-flex;
      align-items: center;
      gap: 0.75rem;
      background: #0084ff;
      color: white;
      padding: 1rem 2rem;
      border-radius: 12px;
      text-decoration: none;
      font-weight: 600;
      font-size: 1.1rem;
      transition: all 0.2s ease;
      box-shadow: 0 4px 20px var(--btn-shadow);
    }
    
    .download-btn:hover {
      background: #0073e6;
      transform: translateY(-2px);
      box-shadow: 0 6px 25px var(--btn-shadow-hover);
    }
    
    .download-btn svg {
      width: 20px;
      height: 20px;
    }
    
    .download-wrapper {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
    }
    
    .mac-homebrew-section {
      margin-top: 1.5rem;
      width: 100%;
      max-width: 500px;
    }
    
    .platform-toggle {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }
    
    .platform-btn {
      background: none;
      border: 1px solid var(--border);
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.2s ease;
    }
    
    .platform-btn:first-child {
      border-radius: 8px 0 0 8px;
    }
    
    .platform-btn:last-child {
      border-radius: 0 8px 8px 0;
    }
    
    .platform-btn:not(:first-child) {
      margin-left: -1px;
    }
    
    .platform-btn.active {
      background: #0084ff;
      border-color: #0084ff;
      color: white;
      position: relative;
      z-index: 1;
    }
    
    
    .platform-link.hidden {
      display: none;
    }
    
    .header-meta {
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }
    
    .github-icon-link {
      color: var(--text-muted);
      display: flex;
      align-items: center;
      transition: color 0.2s ease;
    }
    
    .github-icon-link:hover {
      color: var(--text);
    }
    
    .github-icon-link svg {
      width: 20px;
      height: 20px;
    }
    
    .linux-formats {
      display: none;
      text-align: left;
    }
    
    .linux-formats.visible {
      display: block;
    }
    
    .linux-arch-toggle,
    .windows-arch-toggle,
    .mac-arch-toggle {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }
    
    .arch-btn {
      background: none;
      border: 1px solid var(--border);
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.2s ease;
    }
    
    .arch-btn:first-child {
      border-radius: 8px 0 0 8px;
    }
    
    .arch-btn:last-child {
      border-radius: 0 8px 8px 0;
    }
    
    .arch-btn:not(:first-child) {
      margin-left: -1px;
    }
    
    .arch-btn.active {
      background: #0084ff;
      border-color: #0084ff;
      color: white;
      position: relative;
      z-index: 1;
    }
    
    .linux-format-toggle {
      display: flex;
      justify-content: center;
      margin-bottom: 1rem;
    }
    
    .format-btn {
      background: none;
      border: 1px solid var(--border);
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
      cursor: pointer;
      color: var(--text-muted);
      transition: all 0.2s ease;
    }
    
    .format-btn:first-child {
      border-radius: 8px 0 0 8px;
    }
    
    .format-btn:last-child {
      border-radius: 0 8px 8px 0;
    }
    
    .format-btn:not(:first-child) {
      margin-left: -1px;
    }
    
    .format-btn:hover {
      border-color: #0084ff;
      color: #0084ff;
      position: relative;
      z-index: 1;
    }
    
    .format-btn.active {
      background: #0084ff;
      border-color: #0084ff;
      color: white;
      position: relative;
      z-index: 1;
    }
    
    .format-btn.disabled {
      opacity: 0.4;
      cursor: not-allowed;
    }
    
    .format-btn.disabled:hover {
      border-color: var(--border);
      color: var(--text-muted);
    }
    
    .linux-format-content {
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 1rem;
    }
    
    .linux-command-section {
      width: 100%;
      max-width: 600px;
    }
    
    .linux-format-note {
      font-size: 0.8rem;
      color: var(--text-muted);
      text-align: center;
      padding: 0.5rem;
      background: rgba(0, 132, 255, 0.05);
      border-radius: 6px;
      max-width: 400px;
    }
    
    .format-list {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    
    .format-section-label {
      font-size: 0.75rem;
      font-weight: 600;
      color: var(--text-muted);
      text-transform: uppercase;
      letter-spacing: 0.05em;
      margin-top: 0.5rem;
      margin-bottom: -0.25rem;
    }
    
    .format-section-label:first-child {
      margin-top: 0;
    }
    
    .command-label {
      font-size: 0.8rem;
      color: var(--text-muted);
      margin-bottom: 0.5rem;
      font-weight: 500;
    }
    
    .format-item {
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 10px;
      padding: 1rem;
      text-align: left;
    }
    
    .format-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }
    
    .format-title {
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }
    
    .format-name {
      font-weight: 600;
      font-size: 0.95rem;
      color: var(--text);
    }
    
    .format-desc {
      font-size: 0.75rem;
      color: var(--text-muted);
      background: var(--border);
      padding: 0.15rem 0.5rem;
      border-radius: 4px;
    }
    
    .format-download {
      display: inline-flex;
      align-items: center;
      gap: 0.4rem;
      color: #0084ff;
      text-decoration: none;
      font-size: 0.8rem;
      font-weight: 500;
      padding: 0.3rem 0.75rem;
      border: 1px solid #0084ff;
      border-radius: 6px;
      transition: all 0.2s ease;
    }
    
    .format-download:hover {
      background: #0084ff;
      color: white;
    }
    
    .format-download .ext {
      opacity: 1;
      font-weight: 400;
    }
    
    .format-download:hover .ext {
      opacity: 1;
    }
    
    .format-command {
      display: flex;
      align-items: center;
      background: var(--code-bg);
      border: 1px solid var(--border);
      border-radius: 8px;
      font-family: "SF Mono", "Monaco", "Consolas", monospace;
      font-size: 0.85rem;
      color: var(--text);
      position: relative;
    }
    
    .format-command code {
      flex: 1;
      white-space: nowrap;
      overflow-x: auto;
      padding: 0.75rem 1rem;
      padding-right: 3rem;
    }
    
    .copy-btn {
      position: absolute;
      right: 0;
      top: 0;
      bottom: 0;
      background: linear-gradient(to right, transparent, var(--bg) 30%);
      border: none;
      cursor: pointer;
      padding: 0.25rem 0.5rem 0.25rem 1.5rem;
      color: var(--text-muted);
      transition: color 0.2s ease;
      display: flex;
      align-items: center;
    }
    
    .copy-btn:hover {
      color: #0084ff;
    }
    
    .copy-btn svg {
      width: 14px;
      height: 14px;
    }
    
    .copy-btn.copied {
      color: #22c55e;
    }
    
    .format-pending {
      font-size: 0.7rem;
      color: #f59e0b;
      padding: 0.2rem 0.5rem;
      border: 1px solid #f59e0b;
      border-radius: 4px;
    }
    
    .format-command.format-disabled {
      opacity: 0.5;
    }

    .version-info {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      font-size: 0.8rem;
      color: var(--text-muted);
    }
    
    .version-info span {
      display: flex;
      align-items: center;
      gap: 0.3rem;
    }
    
    .version-badge {
      background: rgba(0, 132, 255, 0.1);
      color: #0084ff;
      padding: 0.2rem 0.5rem;
      border-radius: 5px;
      font-weight: 500;
      font-size: 0.75rem;
      text-decoration: none;
      transition: all 0.2s ease;
    }
    
    .version-badge:hover {
      background: rgba(0, 132, 255, 0.2);
    }
    
    .version-info svg {
      width: 12px;
      height: 12px;
      opacity: 0.7;
    }
    
    .spinner {
      display: none;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255,255,255,0.3);
      border-top-color: white;
      border-radius: 50%;
      animation: spin 0.8s linear infinite;
    }
    
    @keyframes spin {
      to { transform: rotate(360deg); }
    }
    
    .downloading .spinner { display: block; }
    .downloading .download-icon { display: none; }
  </style>
</head>
<body>
  <div class="container">
    <img src="https://raw.githubusercontent.com/apotenza92/facebook-messenger-desktop/main/assets/icons/icon-rounded.png" alt="Messenger" class="icon">
    <h1>Facebook Messenger Desktop</h1>
    <p style="font-size: 0.85rem; color: var(--text-muted); margin-top: 1rem; margin-bottom: 1rem;">An unofficial desktop application for Facebook Messenger.</p>
    
    <div class="header-meta" id="header-meta">
      <div class="version-info" id="version-info">
        <span>
          <svg viewBox="0 0 24 24" fill="currentColor">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-2 15l-5-5 1.41-1.41L10 14.17l7.59-7.59L19 8l-9 9z"/>
          </svg>
          <a href="#" class="version-badge" id="version-badge" title="View release notes">...</a>
        </span>
        <span id="release-date"></span>
      </div>
      <a href="https://github.com/apotenza92/facebook-messenger-desktop" class="github-icon-link" title="View on GitHub">
        <svg viewBox="0 0 24 24" fill="currentColor">
          <path d="M12 0c-6.626 0-12 5.373-12 12 0 5.302 3.438 9.8 8.207 11.387.599.111.793-.261.793-.577v-2.234c-3.338.726-4.033-1.416-4.033-1.416-.546-1.387-1.333-1.756-1.333-1.756-1.089-.745.083-.729.083-.729 1.205.084 1.839 1.237 1.839 1.237 1.07 1.834 2.807 1.304 3.492.997.107-.775.418-1.305.762-1.604-2.665-.305-5.467-1.334-5.467-5.931 0-1.311.469-2.381 1.236-3.221-.124-.303-.535-1.524.117-3.176 0 0 1.008-.322 3.301 1.23.957-.266 1.983-.399 3.003-.404 1.02.005 2.047.138 3.006.404 2.291-1.552 3.297-1.23 3.297-1.23.653 1.653.242 2.874.118 3.176.77.84 1.235 1.911 1.235 3.221 0 4.609-2.807 5.624-5.479 5.921.43.372.823 1.102.823 2.222v3.293c0 .319.192.694.801.576 4.765-1.589 8.199-6.086 8.199-11.386 0-6.627-5.373-12-12-12z"/>
        </svg>
      </a>
    </div>
    
    <div class="platform-toggle" id="platform-toggle">
      <button class="platform-btn" id="platform-btn-mac">macOS</button>
      <button class="platform-btn" id="platform-btn-windows">Windows</button>
      <button class="platform-btn" id="platform-btn-linux">Linux</button>
    </div>
    
    <div class="download-wrapper" id="download-wrapper">
      <div class="windows-arch-toggle" id="windows-arch-toggle" style="display: none;"><button class="arch-btn active" id="windows-arch-x64">x64</button><button class="arch-btn" id="windows-arch-arm64">ARM64</button></div>
      <div class="mac-arch-toggle" id="mac-arch-toggle" style="display: none;"><button class="arch-btn active" id="mac-arch-arm">Apple Silicon</button><button class="arch-btn" id="mac-arch-intel">Intel</button></div>
      <a href="#" class="download-btn" id="download-btn">
        <svg class="download-icon" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
        </svg>
        <div class="spinner"></div>
        <span id="btn-text">Download</span>
      </a>
      <div class="mac-homebrew-section" id="mac-homebrew-section" style="display: none;">
        <div class="command-label">Or install via Homebrew:</div>
        <div class="format-command">
          <code>brew install --cask apotenza92/tap/facebook-messenger-desktop</code>
          <button class="copy-btn" id="mac-homebrew-copy" title="Copy command">
            <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
          </button>
        </div>
      </div>
    </div>
    
    <div class="linux-formats" id="linux-formats">
      <div class="linux-arch-toggle"><button class="arch-btn active" id="arch-x64">x64</button><button class="arch-btn" id="arch-arm64">ARM64</button></div>
      
      <div class="linux-format-toggle" id="linux-format-toggle">
        <button class="format-btn active" data-format="appimage">AppImage</button>
        <button class="format-btn" data-format="deb">Ubuntu / Debian (.deb)</button>
        <button class="format-btn" data-format="rpm">Fedora (.rpm)</button>
        <button class="format-btn" data-format="snap">Snap</button>
        <button class="format-btn" data-format="flatpak">Flatpak</button>
      </div>
      
      <div class="linux-format-content" id="linux-format-content">
        <a href="#" class="download-btn" id="linux-download-btn">
          <svg class="download-icon" viewBox="0 0 24 24" fill="currentColor">
            <path d="M19 9h-4V3H9v6H5l7 7 7-7zM5 18v2h14v-2H5z"/>
          </svg>
          <span id="linux-btn-text">Download AppImage</span>
        </a>
        <div class="linux-command-section">
          <div class="command-label" id="linux-command-label">Download and run AppImage via terminal:</div>
          <div class="format-command">
            <code id="linux-command-code">wget -qO facebook-messenger-desktop-x86_64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage && chmod +x facebook-messenger-desktop-x86_64.AppImage && ./facebook-messenger-desktop-x86_64.AppImage</code>
            <button class="copy-btn" title="Copy command" id="linux-copy-btn">
              <svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>
            </button>
          </div>
        </div>
        <div class="linux-format-note" id="linux-format-note" style="display: none;"></div>
      </div>
    </div>
    
    <p style="font-size: 0.7rem; color: var(--text-subtle); margin-top: 1.5rem; max-width: 500px; margin-left: auto; margin-right: auto; line-height: 1.4;">
      <strong>Trademark Notice:</strong> This project is not affiliated with, endorsed by, or connected to Facebook, Inc. or Meta Platforms, Inc. "Facebook" and "Messenger" are trademarks of Meta Platforms, Inc. This is an independent, open-source project.
    </p>
  </div>

  <script>
    const downloads = {
      'mac-arm': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-macos-arm64.zip',
        name: 'macOS (Apple Silicon)',
        file: 'Messenger-macos-arm64.zip',
        ext: '.zip'
      },
      'mac-intel': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-macos-x64.zip',
        name: 'macOS (Intel)',
        file: 'Messenger-macos-x64.zip',
        ext: '.zip'
      },
      'windows': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-windows-x64-setup.exe',
        name: 'Windows',
        file: 'Messenger-windows-x64-setup.exe',
        ext: '.exe'
      },
      'windows-arm': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/Messenger-windows-arm64-setup.exe',
        name: 'Windows (ARM)',
        file: 'Messenger-windows-arm64-setup.exe',
        ext: '.exe'
      },
      'linux': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage',
        name: 'Linux',
        file: 'facebook-messenger-desktop-x86_64.AppImage',
        ext: '.AppImage',
        showFormats: true,
        arch: 'x64'
      },
      'linux-arm': {
        url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage',
        name: 'Linux (ARM64)',
        file: 'facebook-messenger-desktop-arm64.AppImage',
        ext: '.AppImage',
        showFormats: true,
        arch: 'arm64'
      }
    };

    let currentPlatform = null;

    function getPlatformFromURL() {
      const params = new URLSearchParams(window.location.search);
      const platformParam = params.get('platform');
      if (platformParam === 'windows') {
        return 'windows';
      } else if (platformParam === 'linux') {
        return 'linux';
      } else if (platformParam === 'mac') {
        return 'mac';
      }
      return null;
    }

    function getArchFromURL() {
      const params = new URLSearchParams(window.location.search);
      return params.get('arch'); // Returns 'x64', 'arm64', 'arm', 'intel', or null
    }

    function detectPlatform() {
      // Check URL parameter first
      const urlPlatform = getPlatformFromURL();
      if (urlPlatform) {
        // If platform is specified, check for architecture override
        const urlArch = getArchFromURL();
        if (urlPlatform === 'windows' && urlArch === 'arm64') {
          return 'windows-arm';
        } else if (urlPlatform === 'linux' && urlArch === 'arm64') {
          return 'linux-arm';
        } else if (urlPlatform === 'mac') {
          if (urlArch === 'intel' || urlArch === 'x64') {
            return 'mac-intel';
          } else if (urlArch === 'arm' || urlArch === 'arm64') {
            return 'mac-arm';
          }
          // If no arch specified for mac, will auto-detect below
        } else {
          return urlPlatform;
        }
      }
      
      const ua = navigator.userAgent.toLowerCase();
      const platform = navigator.platform?.toLowerCase() || '';
      
      // Check for Windows
      if (ua.includes('win')) {
        if (ua.includes('arm') || ua.includes('aarch64')) {
          return 'windows-arm';
        }
        return 'windows';
      }
      
      // Check for macOS
      if (ua.includes('mac')) {
        const canvas = document.createElement('canvas');
        const gl = canvas.getContext('webgl');
        let isAppleSilicon = false;
        
        if (gl) {
          const debugInfo = gl.getExtension('WEBGL_debug_renderer_info');
          if (debugInfo) {
            const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);
            if (renderer && renderer.toLowerCase().includes('apple')) {
              isAppleSilicon = true;
            }
          }
        }
        
        if (platform.includes('arm') || ua.includes('arm64') || isAppleSilicon) {
          return 'mac-arm';
        }
        // If not Apple Silicon, it's Intel
        return 'mac-intel';
      }
      
      // Check for Linux
      if (ua.includes('linux') && !ua.includes('android')) {
        if (ua.includes('aarch64') || ua.includes('arm64') || platform.includes('arm')) {
          return 'linux-arm';
        }
        return 'linux';
      }
      
      return 'windows';
    }


    // Linux format data
    const linuxFormats = {
      x64: {
        appimage: {
          url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage',
          btnText: 'Download AppImage (x64)',
          label: 'Download and run AppImage via terminal:',
          command: 'wget -qO facebook-messenger-desktop-x86_64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.AppImage && chmod +x facebook-messenger-desktop-x86_64.AppImage && ./facebook-messenger-desktop-x86_64.AppImage'
        },
        deb: {
          url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-amd64.deb',
          btnText: 'Download .deb (x64)',
          label: 'Download and install .deb via terminal:',
          command: 'wget -qO facebook-messenger-desktop-amd64.deb https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-amd64.deb && sudo apt install ./facebook-messenger-desktop-amd64.deb'
        },
        rpm: {
          url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.rpm',
          btnText: 'Download .rpm (x64)',
          label: 'Download and install .rpm via terminal:',
          command: 'wget -qO facebook-messenger-desktop-x86_64.rpm https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-x86_64.rpm && sudo dnf install ./facebook-messenger-desktop-x86_64.rpm'
        },
        snap: {
          url: 'https://snapcraft.io/facebook-messenger-desktop',
          btnText: 'View in Snap Store',
          label: 'Install Snap via terminal:',
          command: 'sudo snap install facebook-messenger-desktop',
          external: true
        },
        flatpak: {
          url: null,
          btnText: 'Install via Terminal',
          label: 'Add Flatpak repository and install:',
          command: 'flatpak remote-add --if-not-exists --user messenger https://apotenza92.github.io/facebook-messenger-desktop/flatpak/repo && flatpak install --user messenger com.facebook.messenger.desktop',
          noDownload: true
        }
      },
      arm64: {
        appimage: {
          url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage',
          btnText: 'Download AppImage (ARM64)',
          label: 'Download and run AppImage via terminal:',
          command: 'wget -qO facebook-messenger-desktop-arm64.AppImage https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.AppImage && chmod +x facebook-messenger-desktop-arm64.AppImage && ./facebook-messenger-desktop-arm64.AppImage'
        },
        deb: {
          url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.deb',
          btnText: 'Download .deb (ARM64)',
          label: 'Download and install .deb via terminal:',
          command: 'wget -qO facebook-messenger-desktop-arm64.deb https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-arm64.deb && sudo apt install ./facebook-messenger-desktop-arm64.deb'
        },
        rpm: {
          url: 'https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-aarch64.rpm',
          btnText: 'Download .rpm (ARM64)',
          label: 'Download and install .rpm via terminal:',
          command: 'wget -qO facebook-messenger-desktop-aarch64.rpm https://github.com/apotenza92/facebook-messenger-desktop/releases/latest/download/facebook-messenger-desktop-aarch64.rpm && sudo dnf install ./facebook-messenger-desktop-aarch64.rpm'
        },
        snap: {
          disabled: true,
          note: 'Snap is only available for x64. Switch to x64 tab for Snap installation.'
        },
        flatpak: {
          disabled: true,
          note: 'Flatpak is only available for x64. Switch to x64 tab for Flatpak installation.'
        }
      }
    };
    
    let currentLinuxArch = 'x64';
    let currentLinuxFormat = 'appimage';
    
    function setLinuxArch(arch) {
      currentLinuxArch = arch;
      const x64Btn = document.getElementById('arch-x64');
      const arm64Btn = document.getElementById('arch-arm64');
      
      if (arch === 'arm64') {
        x64Btn.classList.remove('active');
        arm64Btn.classList.add('active');
      } else {
        x64Btn.classList.add('active');
        arm64Btn.classList.remove('active');
      }
      
      // Update format button states (some disabled for ARM64)
      document.querySelectorAll('.format-btn').forEach(btn => {
        const format = btn.getAttribute('data-format');
        const formatData = linuxFormats[arch][format];
        if (formatData && formatData.disabled) {
          btn.classList.add('disabled');
        } else {
          btn.classList.remove('disabled');
        }
      });
      
      // If current format is disabled, switch to appimage
      const currentFormatData = linuxFormats[arch][currentLinuxFormat];
      if (currentFormatData && currentFormatData.disabled) {
        setLinuxFormat('appimage');
      } else {
        updateLinuxFormatDisplay();
      }
    }
    
    function setLinuxFormat(format) {
      currentLinuxFormat = format;
      
      // Update button states
      document.querySelectorAll('.format-btn').forEach(btn => {
        btn.classList.remove('active');
        if (btn.getAttribute('data-format') === format) {
          btn.classList.add('active');
        }
      });
      
      updateLinuxFormatDisplay();
    }
    
    function updateLinuxFormatDisplay() {
      const formatData = linuxFormats[currentLinuxArch][currentLinuxFormat];
      const downloadBtn = document.getElementById('linux-download-btn');
      const btnText = document.getElementById('linux-btn-text');
      const commandLabel = document.getElementById('linux-command-label');
      const commandCode = document.getElementById('linux-command-code');
      const formatNote = document.getElementById('linux-format-note');
      const commandSection = document.querySelector('.linux-command-section');
      
      if (formatData.disabled) {
        downloadBtn.style.display = 'none';
        commandSection.style.display = 'none';
        formatNote.style.display = 'block';
        formatNote.textContent = formatData.note;
      } else {
        formatNote.style.display = 'none';
        commandSection.style.display = 'block';
        commandLabel.textContent = formatData.label;
        commandCode.textContent = formatData.command;
        
        if (formatData.noDownload) {
          downloadBtn.style.display = 'none';
        } else {
          downloadBtn.style.display = 'flex';
          downloadBtn.href = formatData.url;
          btnText.textContent = formatData.btnText;
          if (formatData.external) {
            downloadBtn.target = '_blank';
          } else {
            downloadBtn.removeAttribute('target');
          }
        }
      }
    }

    function setWindowsArch(arch) {
      const x64Btn = document.getElementById('windows-arch-x64');
      const arm64Btn = document.getElementById('windows-arch-arm64');
      const btn = document.getElementById('download-btn');
      const btnText = document.getElementById('btn-text');
      
      // Update button states
      if (arch === 'arm64') {
        x64Btn.classList.remove('active');
        arm64Btn.classList.add('active');
        btn.href = downloads['windows-arm'].url;
        btnText.textContent = `Download ${downloads['windows-arm'].ext} (ARM64)`;
      } else {
        x64Btn.classList.add('active');
        arm64Btn.classList.remove('active');
        btn.href = downloads['windows'].url;
        btnText.textContent = `Download ${downloads['windows'].ext} (x64)`;
      }
      
      // Update URL parameter
      const params = new URLSearchParams(window.location.search);
      if (arch === 'arm64') {
        params.set('arch', 'arm64');
      } else {
        params.set('arch', 'x64');
      }
      params.set('platform', 'windows');
      window.history.replaceState({}, '', '?' + params.toString());
    }

    function setMacArch(arch) {
      const armBtn = document.getElementById('mac-arch-arm');
      const intelBtn = document.getElementById('mac-arch-intel');
      const btn = document.getElementById('download-btn');
      const btnText = document.getElementById('btn-text');
      
      // Update button states
      if (arch === 'intel' || arch === 'x64') {
        armBtn.classList.remove('active');
        intelBtn.classList.add('active');
        btn.href = downloads['mac-intel'].url;
        btnText.textContent = `Download ${downloads['mac-intel'].ext} (Intel)`;
      } else {
        armBtn.classList.add('active');
        intelBtn.classList.remove('active');
        btn.href = downloads['mac-arm'].url;
        btnText.textContent = `Download ${downloads['mac-arm'].ext} (Apple Silicon)`;
      }
      
      // Update URL parameter
      const params = new URLSearchParams(window.location.search);
      if (arch === 'intel' || arch === 'x64') {
        params.set('arch', 'intel');
      } else {
        params.set('arch', 'arm');
      }
      params.set('platform', 'mac');
      window.history.replaceState({}, '', '?' + params.toString());
    }

    async function fetchReleaseInfo() {
      try {
        const response = await fetch('https://api.github.com/repos/apotenza92/facebook-messenger-desktop/releases/latest');
        if (!response.ok) throw new Error('Failed to fetch');
        const release = await response.json();
        
        const versionBadge = document.getElementById('version-badge');
        versionBadge.textContent = release.tag_name || release.name;
        versionBadge.href = release.html_url;
        versionBadge.target = '_blank';
        
        const releaseDateEl = document.getElementById('release-date');
        if (release.published_at) {
          const date = new Date(release.published_at);
          const formatted = date.toLocaleDateString('en-US', { 
            month: 'short', 
            day: 'numeric', 
            year: 'numeric' 
          });
          releaseDateEl.innerHTML = `
            <svg viewBox="0 0 24 24" fill="currentColor">
              <path d="M19 3h-1V1h-2v2H8V1H6v2H5c-1.11 0-1.99.9-1.99 2L3 19c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm0 16H5V8h14v11zM9 10H7v2h2v-2zm4 0h-2v2h2v-2zm4 0h-2v2h2v-2z"/>
            </svg>
            ${formatted}
          `;
        }
        
      } catch (e) {
        console.log('Could not fetch release info:', e);
        document.getElementById('header-meta').style.display = 'none';
      }
    }

    function getActualPlatform() {
      // Get the actual platform without URL override
      const ua = navigator.userAgent.toLowerCase();
      const platform = navigator.platform?.toLowerCase() || '';
      
      if (ua.includes('win')) {
        return 'windows';
      }
      if (ua.includes('mac')) {
        return 'mac-arm'; // or mac-intel, but we'll treat all macOS the same for "Other platforms"
      }
      if (ua.includes('linux') && !ua.includes('android')) {
        return 'linux';
      }
      return 'windows';
    }

    function selectPlatform(platform) {
      const btn = document.getElementById('download-btn');
      const btnText = document.getElementById('btn-text');
      const downloadWrapper = document.getElementById('download-wrapper');
      const linuxFormats = document.getElementById('linux-formats');
      const windowsArchToggle = document.getElementById('windows-arch-toggle');
      const macArchToggle = document.getElementById('mac-arch-toggle');
      const macHomebrewSection = document.getElementById('mac-homebrew-section');
      
      // Update platform toggle button states
      document.querySelectorAll('.platform-btn').forEach(b => b.classList.remove('active'));
      
      if (platform === 'mac' || platform === 'mac-arm' || platform === 'mac-intel') {
        document.getElementById('platform-btn-mac').classList.add('active');
        currentPlatform = 'mac-arm';
        
        // Show download wrapper, hide Linux formats
        downloadWrapper.style.display = 'flex';
        linuxFormats.classList.remove('visible');
        macArchToggle.style.display = 'block';
        windowsArchToggle.style.display = 'none';
        macHomebrewSection.style.display = 'block';
        
        // Determine initial architecture
        const urlArch = getArchFromURL();
        let initialArch = 'arm';
        if (urlArch === 'intel' || urlArch === 'x64') {
          initialArch = 'intel';
        } else if (!urlArch) {
          const actualPlatform = getActualPlatform();
          if (actualPlatform === 'mac-intel') {
            initialArch = 'intel';
          }
        }
        setMacArch(initialArch);
        
      } else if (platform === 'windows' || platform === 'windows-arm') {
        document.getElementById('platform-btn-windows').classList.add('active');
        currentPlatform = 'windows';
        
        // Show download wrapper, hide Linux formats
        downloadWrapper.style.display = 'flex';
        linuxFormats.classList.remove('visible');
        windowsArchToggle.style.display = 'block';
        macArchToggle.style.display = 'none';
        macHomebrewSection.style.display = 'none';
        
        // Determine initial architecture
        const urlArch = getArchFromURL();
        let initialArch = 'x64';
        if (urlArch === 'arm64') {
          initialArch = 'arm64';
        } else if (!urlArch) {
          const actualPlatform = getActualPlatform();
          if (actualPlatform === 'windows') {
            const ua = navigator.userAgent.toLowerCase();
            if (ua.includes('arm') || ua.includes('aarch64')) {
              initialArch = 'arm64';
            }
          }
        }
        setWindowsArch(initialArch);
        
      } else {
        // Linux
        document.getElementById('platform-btn-linux').classList.add('active');
        currentPlatform = 'linux';
        
        // Hide download wrapper, show Linux formats
        downloadWrapper.style.display = 'none';
        linuxFormats.classList.add('visible');
        windowsArchToggle.style.display = 'none';
        macArchToggle.style.display = 'none';
        macHomebrewSection.style.display = 'none';
        
        // Determine initial architecture
        const urlArch = getArchFromURL();
        if (urlArch === 'arm64') {
          setLinuxArch('arm64');
        } else {
          setLinuxArch('x64');
        }
      }
      
      // Update URL
      const params = new URLSearchParams(window.location.search);
      if (platform === 'mac' || platform === 'mac-arm' || platform === 'mac-intel') {
        params.set('platform', 'mac');
      } else if (platform === 'linux' || platform === 'linux-arm') {
        params.set('platform', 'linux');
      } else {
        params.set('platform', 'windows');
      }
      window.history.replaceState({}, '', '?' + params.toString());
    }

    function init() {
      // Determine initial platform: URL param > auto-detect
      const urlPlatform = getPlatformFromURL();
      let initialPlatform;
      
      if (urlPlatform) {
        initialPlatform = urlPlatform;
      } else {
        // Auto-detect
        const detected = detectPlatform();
        if (detected === 'mac-arm' || detected === 'mac-intel') {
          initialPlatform = 'mac';
        } else if (detected === 'linux' || detected === 'linux-arm') {
          initialPlatform = 'linux';
        } else {
          initialPlatform = 'windows';
        }
      }
      
      selectPlatform(initialPlatform);
      
      // Platform toggle buttons
      document.getElementById('platform-btn-mac').addEventListener('click', () => selectPlatform('mac'));
      document.getElementById('platform-btn-windows').addEventListener('click', () => selectPlatform('windows'));
      document.getElementById('platform-btn-linux').addEventListener('click', () => selectPlatform('linux'));
      
      // Linux arch toggle buttons
      document.getElementById('arch-x64').addEventListener('click', () => setLinuxArch('x64'));
      document.getElementById('arch-arm64').addEventListener('click', () => setLinuxArch('arm64'));
      
      // Linux format toggle buttons
      document.querySelectorAll('.format-btn').forEach(btn => {
        btn.addEventListener('click', () => {
          const format = btn.getAttribute('data-format');
          const formatData = linuxFormats[currentLinuxArch][format];
          if (!formatData || !formatData.disabled) {
            setLinuxFormat(format);
          }
        });
      });
      
      // Linux copy button
      document.getElementById('linux-copy-btn').addEventListener('click', () => {
        const code = document.getElementById('linux-command-code').textContent;
        navigator.clipboard.writeText(code);
        const copyBtn = document.getElementById('linux-copy-btn');
        copyBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
        setTimeout(() => {
          copyBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>';
        }, 2000);
      });
      
      // macOS Homebrew copy button
      document.getElementById('mac-homebrew-copy').addEventListener('click', () => {
        navigator.clipboard.writeText('brew install --cask apotenza92/tap/facebook-messenger-desktop');
        const copyBtn = document.getElementById('mac-homebrew-copy');
        copyBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/></svg>';
        setTimeout(() => {
          copyBtn.innerHTML = '<svg viewBox="0 0 24 24" fill="currentColor"><path d="M16 1H4c-1.1 0-2 .9-2 2v14h2V3h12V1zm3 4H8c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h11c1.1 0 2-.9 2-2V7c0-1.1-.9-2-2-2zm0 16H8V7h11v14z"/></svg>';
        }, 2000);
      });
      
      // Windows arch toggle buttons
      document.getElementById('windows-arch-x64').addEventListener('click', () => setWindowsArch('x64'));
      document.getElementById('windows-arch-arm64').addEventListener('click', () => setWindowsArch('arm64'));
      
      // macOS arch toggle buttons
      document.getElementById('mac-arch-arm').addEventListener('click', () => setMacArch('arm'));
      document.getElementById('mac-arch-intel').addEventListener('click', () => setMacArch('intel'));
      
      // Download button animation
      const btn = document.getElementById('download-btn');
      btn.addEventListener('click', () => {
        btn.classList.add('downloading');
        const btnText = document.getElementById('btn-text');
        const originalText = btnText.textContent;
        btnText.textContent = 'Starting...';
        setTimeout(() => {
          btn.classList.remove('downloading');
          btnText.textContent = originalText;
        }, 2000);
      });
      
      // Copy buttons
      document.querySelectorAll('.copy-btn').forEach(btn => {
        btn.addEventListener('click', async () => {
          const code = btn.parentElement.querySelector('code').textContent;
          try {
            await navigator.clipboard.writeText(code);
            btn.classList.add('copied');
            setTimeout(() => btn.classList.remove('copied'), 1500);
          } catch (e) {
            console.error('Failed to copy:', e);
          }
        });
      });
      
      fetchReleaseInfo();
    }

    init();
  </script>
</body>
</html>
